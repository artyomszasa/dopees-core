// see: https://tools.ietf.org/html/rfc3986
const regexUri = /^(([a-z][a-z0-9+.-]*):)?(\/\/(([!$&\\'()*,;=a-z0-9._~-]|%[0-9a-f][0-9a-f])*)(\:([0-9]+))?)?(([\/!$&\\'()*,;=:@a-z0-9._~-]|%[0-9a-f][0-9a-f])*)(\?([!$&\\'()*,;=:@a-z0-9._~\/?-]|%[0-9a-f][0-9a-f])*)?(\#.*)?$/i;
const parseQuery = (params, raw) => {
    raw
        .split('&')
        .forEach(one => {
        if (one) {
            const i = one.indexOf('=');
            if (-1 === i) {
                params[one] = null;
            }
            else {
                params[one.substring(0, i)] = decodeURIComponent(one.substring(i + 1));
            }
        }
    });
};
const parse = (uri, raw) => {
    const m = regexUri.exec(raw);
    if (m) {
        uri.scheme = m[2];
        uri.host = m[4];
        uri.path = m[8];
        uri.port = parseInt(m[7], 10) || Uri.defaultPorts[uri.scheme] || 0;
        uri.query = (m[10] && m[10].substr(1) || '');
        uri.fragment = (m[12] && m[12].substr(1) || '');
    }
};
/**
* Simple and straightforward Uri wrapper.
*
* @class dope.Uri
* @param {String} raw - string representation of the Uri.
*/
export class Uri {
    constructor(raw) {
        /** Gets or sets query component of the Uri as object. Allows accessing and
         * manipulating individual arguments within query component. */
        this.queryParams = {};
        parse(this, raw);
    }
    /**
     * Creates {@link Uri} form an argument.
     *
     * @param {string|Uri} uri - Source uri.
     */
    static from(uri) {
        if (uri instanceof Uri) {
            return uri;
        }
        return new Uri(uri);
    }
    /**
     * Is _true_ if the wrapper Uri is relative.
     *
     * @type {Boolean}
     * @readonly
     */
    get isRelative() {
        return !this.scheme;
    }
    /**
     * Is _true_ if the wrapper Uri is absolute.
     *
     * @type {Boolean}
     * @readonly
     */
    get isAbsolute() {
        return !!this.scheme;
    }
    /**
     * Gets or sets authority of the Uri (i.e. hostname and port if non standard).
     *
     * @type {String}
     */
    get authority() {
        if (this.port && this.scheme && this.port !== Uri.defaultPorts[this.scheme]) {
            return `${this.host}:${this.port}`;
        }
        return this.host || '';
    }
    set authority(authority) {
        const i = authority.indexOf(':');
        if (-1 === i) {
            this.host = authority;
            this.port = 0;
        }
        else {
            this.host = authority.substr(0, i);
            this.port = parseInt(authority.substr(i + 1), 10) || 0;
        }
    }
    /**
     * Gets or sets the wrapped Uri.
     *
     * @type {String}
     */
    get href() {
        const query = this.query;
        const queryString = query ? `?${query}` : '';
        const fragment = this.fragment ? `#${this.fragment}` : '';
        const authority = this.authority ? `//${this.authority}` : '';
        const scheme = this.scheme ? `${this.scheme}:` : '';
        return `${scheme}${authority}${this.path}${queryString}${fragment}`;
    }
    set href(href) {
        parse(this, href);
    }
    /**
     * Gets or sets query component of the Uri. To access or manipulate individual query arguments use
     * {@link dope.Uri#queryParams}.
     *
     * @type {String}
     */
    get query() {
        const queryParams = this.queryParams || {};
        return Object.keys(queryParams)
            .map(key => {
            const val = queryParams[key];
            return val ? `${encodeURIComponent(key)}=${encodeURIComponent(val)}` : `${encodeURIComponent(key)}=`;
        })
            .join('&');
    }
    set query(query) {
        this.queryParams = {};
        parseQuery(this.queryParams, query);
    }
    toString() {
        return this.href;
    }
}
Uri.defaultPorts = {
    'http': 80,
    'https': 443
};
;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXJpLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL3VyaS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSwyQ0FBMkM7QUFDM0MsTUFBTSxRQUFRLEdBQUcsZ05BQWdOLENBQUM7QUFXbE8sTUFBTSxVQUFVLEdBQUcsQ0FBQyxNQUFpQixFQUFFLEdBQVcsRUFBRSxFQUFFO0lBQ3BELEdBQUc7U0FDRSxLQUFLLENBQUMsR0FBRyxDQUFDO1NBQ1YsT0FBTyxDQUFDLEdBQUcsQ0FBQyxFQUFFO1FBQ1gsSUFBSSxHQUFHLEVBQUU7WUFDTCxNQUFNLENBQUMsR0FBRyxHQUFHLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQzNCLElBQUksQ0FBQyxDQUFDLEtBQUssQ0FBQyxFQUFFO2dCQUNWLE1BQU0sQ0FBQyxHQUFHLENBQUMsR0FBRyxJQUFJLENBQUM7YUFDdEI7aUJBQU07Z0JBQ0gsTUFBTSxDQUFDLEdBQUcsQ0FBQyxTQUFTLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEdBQUcsa0JBQWtCLENBQUMsR0FBRyxDQUFDLFNBQVMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQzthQUMxRTtTQUNKO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDVCxDQUFDLENBQUM7QUFDRixNQUFNLEtBQUssR0FBRyxDQUFDLEdBQVEsRUFBRSxHQUFXLEVBQUUsRUFBRTtJQUN0QyxNQUFNLENBQUMsR0FBRyxRQUFRLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQzdCLElBQUksQ0FBQyxFQUFFO1FBQ0gsR0FBRyxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDbEIsR0FBRyxDQUFDLElBQUksR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDaEIsR0FBRyxDQUFDLElBQUksR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDaEIsR0FBRyxDQUFDLElBQUksR0FB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QUNWLE9BQU8sRUFBRSxHQUFHO0NBQ2IsQ0FBQztBQXlHSCxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLy8gc2VlOiBodHRwczovL3Rvb2xzLmlldGYub3JnL2h0bWwvcmZjMzk4NlxuY29uc3QgcmVnZXhVcmkgPSAvXigoW2Etel1bYS16MC05Ky4tXSopOik/KFxcL1xcLygoWyEkJlxcXFwnKCkqLDs9YS16MC05Ll9+LV18JVswLTlhLWZdWzAtOWEtZl0pKikoXFw6KFswLTldKykpPyk/KChbXFwvISQmXFxcXCcoKSosOz06QGEtejAtOS5ffi1dfCVbMC05YS1mXVswLTlhLWZdKSopKFxcPyhbISQmXFxcXCcoKSosOz06QGEtejAtOS5fflxcLz8tXXwlWzAtOWEtZl1bMC05YS1mXSkqKT8oXFwjLiopPyQvaTtcblxuaW50ZXJmYWNlIFN0cmluZ01hcCB7XG4gIFtrZXk6IHN0cmluZ106IHN0cmluZ3xudWxsfHVuZGVmaW5lZDtcbn1cblxuaW50ZXJmYWNlIERlZmF1bHRQb3J0cyB7XG4gIFtrZXk6IHN0cmluZ106IG51bWJlcnx1bmRlZmluZWQ7XG59XG5cblxuY29uc3QgcGFyc2VRdWVyeSA9IChwYXJhbXM6IFN0cmluZ01hcCwgcmF3OiBzdHJpbmcpID0+IHtcbiAgcmF3XG4gICAgICAuc3BsaXQoJyYnKVxuICAgICAgLmZvckVhY2gob25lID0+IHtcbiAgICAgICAgICBpZiAob25lKSB7XG4gICAgICAgICAgICAgIGNvbnN0IGkgPSBvbmUuaW5kZXhPZignPScpO1xuICAgICAgICAgICAgICBpZiAoLTEgPT09IGkpIHtcbiAgICAgICAgICAgICAgICAgIHBhcmFtc1tvbmVdID0gbnVsbDtcbiAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgIHBhcmFtc1tvbmUuc3Vic3RyaW5nKDAsIGkpXSA9IGRlY29kZVVSSUNvbXBvbmVudChvbmUuc3Vic3RyaW5nKGkgKyAxKSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICB9KTtcbn07XG5jb25zdCBwYXJzZSA9ICh1cmk6IFVyaSwgcmF3OiBzdHJpbmcpID0+IHtcbiAgY29uc3QgbSA9IHJlZ2V4VXJpLmV4ZWMocmF3KTtcbiAgaWYgKG0pIHtcbiAgICAgIHVyaS5zY2hlbWUgPSBtWzJdO1xuICAgICAgdXJpLmhvc3QgPSBtWzRdO1xuICAgICAgdXJpLnBhdGggPSBtWzhdO1xuICAgICAgdXJpLnBvcnQgPSBwYXJzZUludChtWzddLCAxMCkgfHwgVXJpLmRlZmF1bHRQb3J0c1t1cmkuc2NoZW1lXSB8fCAwO1xuICAgICAgdXJpLnF1ZXJ5ID0gKG1bMTBdICYmIG1bMTBdLnN1YnN0cigxKSB8fCAnJyk7XG4gICAgICB1cmkuZnJhZ21lbnQgPSAobVsxMl0gJiYgbVsxMl0uc3Vic3RyKDEpIHx8ICcnKTtcbiAgfVxufTtcbi8qKlxuKiBTaW1wbGUgYW5kIHN0cmFpZ2h0Zm9yd2FyZCBVcmkgd3JhcHBlci5cbipcbiogQGNsYXNzIGRvcGUuVXJpXG4qIEBwYXJhbSB7U3RyaW5nfSByYXcgLSBzdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgdGhlIFVyaS5cbiovXG5leHBvcnQgY2xhc3MgVXJpIHtcbiAgc3RhdGljIGRlZmF1bHRQb3J0czogRGVmYXVsdFBvcnRzID0ge1xuICAgICdodHRwJzogODAsXG4gICAgJ2h0dHBzJzogNDQzXG4gIH07XG4gIC8qKiBHZXRzIG9yIHNldHMgc2NoZW1lIG9mIHRoZSBVcmkuICovXG4gIHNjaGVtZT86IHN0cmluZztcbiAgLyoqIEdldHMgb3Igc2V0cyBob3N0bmFtZSBvZiB0aGUgVXJpLiAqL1xuICBob3N0Pzogc3RyaW5nO1xuICAvKiogR2V0cyBvciBzZXRzIHBhdGggY29tcG9uZW50IG9mIHRoZSBVcmkuICovXG4gIHBhdGghOiBzdHJpbmc7XG4gIC8qKiBHZXRzIG9yIHNldHMgcG9ydCBvZiB0aGUgVXJpLiAqL1xuICBwb3J0PzogbnVtYmVyO1xuICAvKiogR2V0cyBvciBzZXRzIGZyYWdtZW50IG9mIHRoZSBVcmkuICovXG4gIGZyYWdtZW50Pzogc3RyaW5nO1xuICAvKiogR2V0cyBvciBzZXRzIHF1ZXJ5IGNvbXBvbmVudCBvZiB0aGUgVXJpIGFzIG9iamVjdC4gQWxsb3dzIGFjY2Vzc2luZyBhbmRcbiAgICogbWFuaXB1bGF0aW5nIGluZGl2aWR1YWwgYXJndW1lbnRzIHdpdGhpbiBxdWVyeSBjb21wb25lbnQuICovXG4gIHF1ZXJ5UGFyYW1zOiBTdHJpbmdNYXAgPSB7fTtcbiAgLyoqXG4gICAqIENyZWF0ZXMge0BsaW5rIFVyaX0gZm9ybSBhbiBhcmd1bWVudC5cbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd8VXJpfSB1cmkgLSBTb3VyY2UgdXJpLlxuICAgKi9cbiAgc3RhdGljIGZyb20odXJpOiBzdHJpbmd8VXJpKSB7XG4gICAgaWYgKHVyaSBpbnN0YW5jZW9mIFVyaSkge1xuICAgICAgcmV0dXJuIHVyaTtcbiAgICB9XG4gICAgcmV0dXJuIG5ldyBVcmkodXJpKTtcbiAgfVxuICBjb25zdHJ1Y3RvcihyYXc6IHN0cmluZykge1xuICAgICAgcGFyc2UodGhpcywgcmF3KTtcbiAgfVxuICAvKipcbiAgICogSXMgX3RydWVfIGlmIHRoZSB3cmFwcGVyIFVyaSBpcyByZWxhdGl2ZS5cbiAgICpcbiAgICogQHR5cGUge0Jvb2xlYW59XG4gICAqIEByZWFkb25seVxuICAgKi9cbiAgZ2V0IGlzUmVsYXRpdmUgKCkge1xuICAgICAgcmV0dXJuICF0aGlzLnNjaGVtZTtcbiAgfVxuICAvKipcbiAgICogSXMgX3RydWVfIGlmIHRoZSB3cmFwcGVyIFVyaSBpcyBhYnNvbHV0ZS5cbiAgICpcbiAgICogQHR5cGUge0Jvb2xlYW59XG4gICAqIEByZWFkb25seVxuICAgKi9cbiAgZ2V0IGlzQWJzb2x1dGUgKCkge1xuICAgICAgcmV0dXJuICEhdGhpcy5zY2hlbWU7XG4gIH1cbiAgLyoqXG4gICAqIEdldHMgb3Igc2V0cyBhdXRob3JpdHkgb2YgdGhlIFVyaSAoaS5lLiBob3N0bmFtZSBhbmQgcG9ydCBpZiBub24gc3RhbmRhcmQpLlxuICAgKlxuICAgKiBAdHlwZSB7U3RyaW5nfVxuICAgKi9cbiAgZ2V0IGF1dGhvcml0eSAoKSB7XG4gICAgICBpZiAodGhpcy5wb3J0ICYmIHRoaXMuc2NoZW1lICYmIHRoaXMucG9ydCAhPT0gVXJpLmRlZmF1bHRQb3J0c1t0aGlzLnNjaGVtZV0pIHtcbiAgICAgICAgICByZXR1cm4gYCR7dGhpcy5ob3N0fToke3RoaXMucG9ydH1gO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHRoaXMuaG9zdCB8fCAnJztcbiAgfVxuICBzZXQgYXV0aG9yaXR5KGF1dGhvcml0eTogc3RyaW5nKSB7XG4gICAgICBjb25zdCBpID0gYXV0aG9yaXR5LmluZGV4T2YoJzonKTtcbiAgICAgIGlmICgtMSA9PT0gaSkge1xuICAgICAgICAgIHRoaXMuaG9zdCA9IGF1dGhvcml0eTtcbiAgICAgICAgICB0aGlzLnBvcnQgPSAwO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGlzLmhvc3QgPSBhdXRob3JpdHkuc3Vic3RyKDAsIGkpO1xuICAgICAgICAgIHRoaXMucG9ydCA9IHBhcnNlSW50KGF1dGhvcml0eS5zdWJzdHIoaSArIDEpLCAxMCkgfHwgMDtcbiAgICAgIH1cbiAgfVxuICAvKipcbiAgICogR2V0cyBvciBzZXRzIHRoZSB3cmFwcGVkIFVyaS5cbiAgICpcbiAgICogQHR5cGUge1N0cmluZ31cbiAgICovXG4gIGdldCBocmVmICgpIHtcbiAgICAgIGNvbnN0IHF1ZXJ5ID0gdGhpcy5xdWVyeTtcbiAgICAgIGNvbnN0IHF1ZXJ5U3RyaW5nID0gcXVlcnkgPyBgPyR7cXVlcnl9YCA6ICcnO1xuICAgICAgY29uc3QgZnJhZ21lbnQgPSB0aGlzLmZyYWdtZW50ID8gYCMke3RoaXMuZnJhZ21lbnR9YCA6ICcnO1xuICAgICAgY29uc3QgYXV0aG9yaXR5ID0gdGhpcy5hdXRob3JpdHkgPyBgLy8ke3RoaXMuYXV0aG9yaXR5fWAgOiAnJztcbiAgICAgIGNvbnN0IHNjaGVtZSA9IHRoaXMuc2NoZW1lID8gYCR7dGhpcy5zY2hlbWV9OmAgOiAnJztcbiAgICAgIHJldHVybiBgJHtzY2hlbWV9JHthdXRob3JpdHl9JHt0aGlzLnBhdGh9JHtxdWVyeVN0cmluZ30ke2ZyYWdtZW50fWA7XG4gIH1cbiAgc2V0IGhyZWYgKGhyZWYpIHtcbiAgICAgIHBhcnNlKHRoaXMsIGhyZWYpO1xuICB9XG4gIC8qKlxuICAgKiBHZXRzIG9yIHNldHMgcXVlcnkgY29tcG9uZW50IG9mIHRoZSBVcmkuIFRvIGFjY2VzcyBvciBtYW5pcHVsYXRlIGluZGl2aWR1YWwgcXVlcnkgYXJndW1lbnRzIHVzZVxuICAgKiB7QGxpbmsgZG9wZS5VcmkjcXVlcnlQYXJhbXN9LlxuICAgKlxuICAgKiBAdHlwZSB7U3RyaW5nfVxuICAgKi9cbiAgZ2V0IHF1ZXJ5ICgpIHtcbiAgICAgIGNvbnN0IHF1ZXJ5UGFyYW1zID0gdGhpcy5xdWVyeVBhcmFtcyB8fCB7fTtcbiAgICAgIHJldHVybiBPYmplY3Qua2V5cyhxdWVyeVBhcmFtcylcbiAgICAgICAgICAubWFwKGtleSA9PiB7XG4gICAgICAgICAgICBjb25zdCB2YWwgPSBxdWVyeVBhcmFtc1trZXldO1xuICAgICAgICAgICAgcmV0dXJuIHZhbCA/IGAke2VuY29kZVVSSUNvbXBvbmVudChrZXkpfT0ke2VuY29kZVVSSUNvbXBvbmVudCh2YWwpfWAgOiBgJHtlbmNvZGVVUklDb21wb25lbnQoa2V5KX09YDtcbiAgICAgICAgICB9KVxuICAgICAgICAgIC5qb2luKCcmJyk7XG4gIH1cbiAgc2V0IHF1ZXJ5IChxdWVyeSkge1xuICAgICAgdGhpcy5xdWVyeVBhcmFtcyA9IHt9O1xuICAgICAgcGFyc2VRdWVyeSh0aGlzLnF1ZXJ5UGFyYW1zLCBxdWVyeSk7XG4gIH1cbiAgdG9TdHJpbmcgKCkge1xuICAgICAgcmV0dXJuIHRoaXMuaHJlZjtcbiAgfVxufTsiXX0=