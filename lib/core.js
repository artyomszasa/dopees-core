const logEvent = 'dope-log';
export function pushMsg(msg, severity) {
    const ev = document.createEvent('CustomEvent');
    ev.initCustomEvent(logEvent, false, false, {
        message: msg,
        severity: severity || 'log'
    });
    window.dispatchEvent(ev);
}
export function pushErr(msg) { pushMsg(msg, 'error'); }
const callbacks = new Map();
export function offMessage(callback) {
    const cb = callbacks.get(callback);
    if (cb) {
        callbacks.delete(callback);
        window.removeEventListener(logEvent, cb, false);
    }
}
export function onMessage(callback) {
    const cb = (e) => callback(e.detail);
    callbacks.set(callback, cb);
    window.addEventListener(logEvent, cb, false);
    return {
        remove: () => offMessage(callback)
    };
}
onMessage(data => {
    if (window.console) {
        const severity = data.severity;
        const log = window.console[severity] || window.console.log || (() => { });
        log.call(window.console, data.message);
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29yZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL3NyYy9jb3JlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLE1BQU0sUUFBUSxHQUFHLFVBQVUsQ0FBQztBQU81QixNQUFNLFVBQVUsT0FBTyxDQUFDLEdBQVEsRUFBRSxRQUErQjtJQUMvRCxNQUFNLEVBQUUsR0FBRyxRQUFRLENBQUMsV0FBVyxDQUFDLGFBQWEsQ0FBQyxDQUFDO0lBQy9DLEVBQUUsQ0FBQyxlQUFlLENBQUMsUUFBUSxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUU7UUFDdkMsT0FBTyxFQUFFLEdBQUc7UUFDWixRQUFRLEVBQUUsUUFBUSxJQUFJLEtBQUs7S0FDOUIsQ0FBQyxDQUFDO0lBQ0gsTUFBTSxDQUFDLGFBQWEsQ0FBQyxFQUFFLENBQUMsQ0FBQztBQUMzQixDQUFDO0FBRUQsTUFBTSxVQUFVLE9BQU8sQ0FBQyxHQUFRLElBQUksT0FBTyxDQUFDLEdBQUcsRUFBRSxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFFNUQsTUFBTSxTQUFTLEdBQTRCLElBQUksR0FBRyxFQUFFLENBQUM7QUFFckQsTUFBTSxVQUFVLFVBQVUsQ0FBQyxRQUEyQztJQUNwRSxNQUFNLEVBQUUsR0FBRyxTQUFTLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxDQUFDO0lBQ25DLElBQUksRUFBRSxFQUFFO1FBQ04sU0FBUyxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUMzQixNQUFNLENBQUMsbUJBQW1CLENBQUMsUUFBUSxFQUFPLEVBQUUsRUFBRSxLQUFLLENBQUMsQ0FBQztLQUN0RDtBQUNILENBQUM7QUFFRCxNQUFNLFVBQVUsU0FBUyxDQUFDLFFBQTJDO0lBQ25FLE1BQU0sRUFBRSxHQUFHLENBQUMsQ0FBOEIsRUFBRSxFQUFFLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUNsRSxTQUFTLENBQUMsR0FBRyxDQUFDLFFBQVEsRUFBRSxFQUFFLENBQUMsQ0FBQztJQUM1QixNQUFNLENBQUMsZ0JBQWdCLENBQUMsUUFBUSxFQUFPLEVBQUUsRUFBRSxLQUFLLENBQUMsQ0FBQztJQUNsRCxPQUFPO1FBQ0wsTUFBTSxFQUFFLEdBQUcsRUFBRSxDQUFDLFVBQVUsQ0FBQyxRQUFRLENBQUM7S0FDbkMsQ0FBQztBQUNKLENBQUM7QUFHRCxTQUFTLENBQUMsSUFBSSxDQUFDLEVBQUU7SUFDZixJQUFJLE1BQU0sQ0FBQyxPQUFPLEVBQUU7UUFDbEIsTUFBTSxRQUFRLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQztRQUMvQixNQUFNLEdBQUcsR0FBRyxNQUFNLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxJQUFJLE1BQU0sQ0FBQyxPQUFPLENBQUMsR0FBRyxJQUFJLENBQUMsR0FBRyxFQUFFLEdBQUUsQ0FBQyxDQUFDLENBQUM7UUFDekUsR0FBRyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsT0FBTyxFQUFFLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztLQUN4QztBQUNILENBQUMsQ0FBQyxDQUFBIn0=