const regexJsonMilliseconds = /\.[0-9]+(Z|\+[0-9]{1,2}(:[0-9]{1,2})?)$/i;
const dateFromJson = (json) => {
    const fixed = json.replace(regexJsonMilliseconds, '$1');
    return new Date(fixed);
};
const dateFromTime = (milliseconds) => {
    const result = new Date();
    result.setTime(milliseconds);
    return result;
};
const regexTimeSpan = /^(-)?(([0-9]+)\.)?([0-9]{1,2}):([0-9]{1,2})(:([0-9]{1,2})(\.([0-9]{1,3}))?)?$/;
const monthLengths = [
    31,
    NaN,
    31,
    30,
    31,
    30,
    31,
    31,
    30,
    31,
    30,
    31 // dec
];
const pow10 = (n) => {
    switch (n) {
        case 0:
            return 1;
        case 1:
            return 10;
        case 2:
            return 100;
        case 3:
            return 1000;
        default:
            let res = 1;
            for (let i = 0; i < n; ++i) {
                res *= 10;
            }
            return res;
    }
};
const pad3 = (n) => {
    if (n < 10) {
        return `00${n}`;
    }
    if (n < 100) {
        return `0${n}`;
    }
    return String(n);
};
const parseTimeStamp = (input) => {
    const m = regexTimeSpan.exec(input);
    if (!m) {
        throw new Error(`invalid timestamp value: "${input}"`);
    }
    let milliseconds = m[9] ? parseInt(m[9], 10) * pow10(3 - m[9].length) : 0;
    milliseconds += (parseInt(m[7], 10) || 0) * TimeSpan.millisecondsInSecond;
    milliseconds += (parseInt(m[5], 10) || 0) * TimeSpan.millisecondsInMinute;
    milliseconds += (parseInt(m[4], 10) || 0) * TimeSpan.millisecondsInHour;
    milliseconds += (parseInt(m[3], 10) || 0) * TimeSpan.millisecondsInDay;
    if ('-' === m[1]) {
        milliseconds = -milliseconds;
    }
    return milliseconds;
};
export class TimeSpan {
    constructor(source) {
        if ('number' === typeof source) {
            this.value = source;
        }
        else {
            this.value = parseTimeStamp(source);
        }
    }
    get milliseconds() { return this.value % TimeSpan.millisecondsInSecond; }
    get seconds() { return Math.floor(this.totalSeconds) % 60; }
    get minutes() { return Math.floor(this.totalMinutes) % 60; }
    get hours() { return Math.floor(this.totalHours) % 24; }
    get days() { return Math.floor(this.totalDays); }
    get totalMilliseconds() { return this.value; }
    get totalSeconds() { return this.value / TimeSpan.millisecondsInSecond; }
    get totalMinutes() { return this.value / TimeSpan.millisecondsInMinute; }
    get totalHours() { return this.value / TimeSpan.millisecondsInHour; }
    get totalDays() { return this.value / TimeSpan.millisecondsInDay; }
    abs() {
        return new TimeSpan(Math.abs(this.value));
    }
    addMilliseconds(milliseconds) {
        return new TimeSpan(this.value + milliseconds);
    }
    addSeconds(seconds) {
        return this.addMilliseconds(seconds * TimeSpan.millisecondsInSecond);
    }
    addMinutes(minutes) {
        return this.addMilliseconds(minutes * TimeSpan.millisecondsInMinute);
    }
    addHours(hours) {
        return this.addMilliseconds(hours * TimeSpan.millisecondsInHour);
    }
    addDays(days) {
        return this.addMilliseconds(days * TimeSpan.millisecondsInDay);
    }
    add(value) {
        const milliseconds = value instanceof TimeSpan ? value.totalMilliseconds : value;
        return this.addMilliseconds(milliseconds);
    }
    neg() {
        return new TimeSpan(-1 * this.value);
    }
    subMilliseconds(milliseconds) {
        return new TimeSpan(this.value - milliseconds);
    }
    subSeconds(seconds) {
        return this.subMilliseconds(seconds * TimeSpan.millisecondsInSecond);
    }
    subMinutes(minutes) {
        return this.subMilliseconds(minutes * TimeSpan.millisecondsInMinute);
    }
    subHours(hours) {
        return this.subMilliseconds(hours * TimeSpan.millisecondsInHour);
    }
    subDays(days) {
        return this.subMilliseconds(days * TimeSpan.millisecondsInDay);
    }
    sub(value) {
        const milliseconds = value instanceof TimeSpan ? value.totalMilliseconds : value;
        return this.subMilliseconds(milliseconds);
    }
    equalsTo(other) {
        return this.value === other.value;
    }
    compareTo(other) {
        return this.value > other.value ? 1 : (this.value === other.value ? 0 : -1);
    }
    toString() {
        if (this.value < 0) {
            return `-${this.abs()}`;
        }
        const days = this.days;
        const hours = this.hours;
        const minutes = this.minutes;
        const seconds = this.seconds;
        const milliseconds = this.milliseconds;
        if (days) {
            if (seconds || !milliseconds) {
                return `${days}.${hours}.${minutes}.${seconds}`;
            }
            if (milliseconds) {
                return `${days}.${hours}.${minutes}.${seconds}.${pad3(milliseconds)}`;
            }
            return `${days}.${hours}.${minutes}`;
        }
        if (seconds || !milliseconds) {
            return `${hours}.${minutes}.${seconds}`;
        }
        if (milliseconds) {
            return `${hours}.${minutes}.${seconds}.${pad3(milliseconds)}`;
        }
        return `${hours}.${minutes}`;
    }
}
TimeSpan.millisecondsInSecond = 1000;
TimeSpan.millisecondsInMinute = 60000;
TimeSpan.millisecondsInHour = 3600000;
TimeSpan.millisecondsInDay = 86400000;
export class DateTime {
    /**
     * Returns amount of days in the specified month.
     * @param month Month.
     * @param year Year.
     */
    static getMonthLength(month, year) {
        if (month < 1 || month > 12) {
            throw new RangeError('month out of range');
        }
        if (month !== 2) {
            return monthLengths[month - 1];
        }
        return (0 === year % 4 && (0 !== year % 100 || 0 === year % 400)) ? 29 : 28;
    }
    get isValid() { return !isNaN(this.source.getTime()); }
    get year() { return this.source.getFullYear(); }
    get month() { return this.source.getMonth() + 1; }
    get day() { return this.source.getDate(); }
    get dayOfWeek() { return this.source.getDay(); }
    get hours() { return this.source.getHours(); }
    get minutes() { return this.source.getMinutes(); }
    get seconds() { return this.source.getSeconds(); }
    get milliseconds() { return this.source.getMilliseconds(); }
    constructor(source) {
        if (undefined === source || null === source) {
            this.source = new Date();
        }
        else if ('string' === typeof source) {
            this.source = dateFromJson(source);
        }
        else if ('number' === typeof source) {
            this.source = dateFromTime(source);
        }
        else if (source instanceof Date) {
            this.source = source;
        }
        else {
            // assume init
            const init = source;
            this.source = new Date(init.year || new Date().getFullYear(), init.month ? init.month - 1 : 0, init.day || 1, init.hours || 0, init.minutes || 0, init.seconds || 0, init.milliseconds || 0);
        }
    }
    equalsTo(other) {
        return this.source.getTime() === other.source.getTime();
    }
    compareTo(other) {
        return this.source < other.source ? -1 : (this.equalsTo(other) ? 0 : 1);
    }
    addMilliseconds(milliseconds) {
        const res = dateFromTime(this.source.getTime() + milliseconds);
        const offsetDelta = this.source.getTimezoneOffset() - res.getTimezoneOffset();
        if (offsetDelta !== 0) {
            const adjust = offsetDelta * TimeSpan.millisecondsInMinute;
            res.setTime(res.getTime() - adjust);
        }
        return new DateTime(res);
    }
    addSeconds(seconds) {
        return this.addMilliseconds(seconds * TimeSpan.millisecondsInSecond);
    }
    addMinutes(minutes) {
        return this.addMilliseconds(minutes * TimeSpan.millisecondsInMinute);
    }
    addHours(hours) {
        return this.addMilliseconds(hours * TimeSpan.millisecondsInHour);
    }
    addDays(days) {
        return this.addMilliseconds(days * TimeSpan.millisecondsInDay);
    }
    addMonths(months) {
        if (0 === months) {
            return this.addDays(0);
        }
        if (0 < months) {
            const full = Math.floor(months) + (this.month - 1);
            const fm = full % 12;
            const fy = Math.floor(full / 12);
            let res = new DateTime({
                year: this.year + fy,
                month: fm + 1,
                day: Math.min(DateTime.getMonthLength(fm + 1, this.year + fy), this.day),
                hours: this.hours,
                minutes: this.minutes,
                seconds: this.seconds,
                milliseconds: this.milliseconds
            });
            const part = months % 1;
            if (0 === part) {
                return res;
            }
            return res.addDays(DateTime.getMonthLength(res.month, res.year) * part);
        }
        else {
            const abs = Math.abs(months);
            let m = (this.month - 1) - Math.floor(abs);
            let y = this.year;
            while (0 > m) {
                y = y - 1;
                m = m + 12;
            }
            const part = abs % 1;
            if (0 === part) {
                return new DateTime({
                    year: y,
                    month: m + 1,
                    day: this.day,
                    hours: this.hours,
                    minutes: this.minutes,
                    seconds: this.seconds,
                    milliseconds: this.milliseconds
                });
            }
            if (0 === m) {
                y = y - 1;
                m = 11;
            }
            else {
                m = m - 1;
            }
            const days = DateTime.getMonthLength(m + 1, y);
            const toAdd = days * (1 - part);
            return new DateTime({
                year: y,
                month: m,
                day: this.day,
                hours: this.hours,
                minutes: this.minutes,
                seconds: this.seconds,
                milliseconds: this.milliseconds
            }).addDays(toAdd);
        }
    }
    add(value) {
        if (value instanceof TimeSpan) {
            return this.addMilliseconds(value.totalMilliseconds);
        }
        return this.addMilliseconds(value);
    }
    substract(value) {
        if (value instanceof DateTime) {
            return new TimeSpan(this.source.getTime() - value.source.getTime());
        }
        if (value instanceof TimeSpan) {
            return this.add(-1 * value.totalMilliseconds);
        }
        return this.add(-1 * value);
    }
    toDate() {
        const result = new Date();
        result.setTime(this.source.getTime());
        return result;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0ZXRpbWUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvZGF0ZXRpbWUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBRUEsTUFBTSxxQkFBcUIsR0FBRywwQ0FBMEMsQ0FBQztBQUV6RSxNQUFNLFlBQVksR0FBRyxDQUFDLElBQVksRUFBRSxFQUFFO0lBQ3BDLE1BQU0sS0FBSyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMscUJBQXFCLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFDeEQsT0FBTyxJQUFJLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztBQUN6QixDQUFDLENBQUE7QUFFRCxNQUFNLFlBQVksR0FBRyxDQUFDLFlBQW9CLEVBQUUsRUFBRTtJQUM1QyxNQUFNLE1BQU0sR0FBRyxJQUFJLElBQUksRUFBRSxDQUFDO0lBQzFCLE1BQU0sQ0FBQyxPQUFPLENBQUMsWUFBWSxDQUFDLENBQUM7SUFDN0IsT0FBTyxNQUFNLENBQUM7QUFDaEIsQ0FBQyxDQUFBO0FBRUQsTUFBTSxhQUFhLEdBQUcsK0VBQStFLENBQUM7QUFFdEcsTUFBTSxZQUFZLEdBQUc7SUFDbkIsRUFBRTtJQUNGLEdBQUc7SUFDSCxFQUFFO0lBQ0YsRUFBRTtJQUNGLEVBQUU7SUFDRixFQUFFO0lBQ0YsRUFBRTtJQUNGLEVBQUU7SUFDRixFQUFFO0lBQ0YsRUFBRTtJQUNGLEVBQUU7SUFDRixFQUFFLENBQUUsTUFBTTtDQUNYLENBQUM7QUFFRixNQUFNLEtBQUssR0FBRyxDQUFDLENBQVMsRUFBRSxFQUFFO0lBQzFCLFFBQU8sQ0FBQyxFQUFFO1FBQ1IsS0FBSyxDQUFDO1lBQ0osT0FBTyxDQUFDLENBQUM7UUFDWCxLQUFLLENBQUM7WUFDSixPQUFPLEVBQUUsQ0FBQztRQUNaLEtBQUssQ0FBQztZQUNKLE9BQU8sR0FBRyxDQUFDO1FBQ2IsS0FBSyxDQUFDO1lBQ0osT0FBTyxJQUFJLENBQUM7UUFDZDtZQUNFLElBQUksR0FBRyxHQUFHLENBQUMsQ0FBQztZQUNa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WyJpbXBvcnQgeyBFcXVhdGFibGUsIENvbXBhcmFibGUgfSBmcm9tIFwiLi9jb250cmFjdFwiO1xuXG5jb25zdCByZWdleEpzb25NaWxsaXNlY29uZHMgPSAvXFwuWzAtOV0rKFp8XFwrWzAtOV17MSwyfSg6WzAtOV17MSwyfSk/KSQvaTtcblxuY29uc3QgZGF0ZUZyb21Kc29uID0gKGpzb246IHN0cmluZykgPT4ge1xuICBjb25zdCBmaXhlZCA9IGpzb24ucmVwbGFjZShyZWdleEpzb25NaWxsaXNlY29uZHMsICckMScpO1xuICByZXR1cm4gbmV3IERhdGUoZml4ZWQpO1xufVxuXG5jb25zdCBkYXRlRnJvbVRpbWUgPSAobWlsbGlzZWNvbmRzOiBudW1iZXIpID0+IHtcbiAgY29uc3QgcmVzdWx0ID0gbmV3IERhdGUoKTtcbiAgcmVzdWx0LnNldFRpbWUobWlsbGlzZWNvbmRzKTtcbiAgcmV0dXJuIHJlc3VsdDtcbn1cblxuY29uc3QgcmVnZXhUaW1lU3BhbiA9IC9eKC0pPygoWzAtOV0rKVxcLik/KFswLTldezEsMn0pOihbMC05XXsxLDJ9KSg6KFswLTldezEsMn0pKFxcLihbMC05XXsxLDN9KSk/KT8kLztcblxuY29uc3QgbW9udGhMZW5ndGhzID0gW1xuICAzMSwgLy8gamFuXG4gIE5hTiwgLy8gZmViXG4gIDMxLCAgLy8gbWFyXG4gIDMwLCAgLy8gYXByXG4gIDMxLCAgLy8gbWF5XG4gIDMwLCAgLy8ganVuXG4gIDMxLCAgLy8ganVsXG4gIDMxLCAgLy8gYXVnXG4gIDMwLCAgLy8gc2VwXG4gIDMxLCAgLy8gb2t0XG4gIDMwLCAgLy8gbm92XG4gIDMxICAvLyBkZWNcbl07XG5cbmNvbnN0IHBvdzEwID0gKG46IG51bWJlcikgPT4ge1xuICBzd2l0Y2gobikge1xuICAgIGNhc2UgMDpcbiAgICAgIHJldHVybiAxO1xuICAgIGNhc2UgMTpcbiAgICAgIHJldHVybiAxMDtcbiAgICBjYXNlIDI6XG4gICAgICByZXR1cm4gMTAwO1xuICAgIGNhc2UgMzpcbiAgICAgIHJldHVybiAxMDAwO1xuICAgIGRlZmF1bHQ6XG4gICAgICBsZXQgcmVzID0gMTtcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbjsgKytpKSB7XG4gICAgICAgIHJlcyAqPSAxMDtcbiAgICAgIH1cbiAgICAgIHJldHVybiByZXM7XG4gIH1cbn1cblxuY29uc3QgcGFkMyA9IChuOiBudW1iZXIpID0+IHtcbiAgaWYgKG4gPCAxMCkge1xuICAgIHJldHVybiBgMDAke259YDtcbiAgfVxuICBpZiAobiA8IDEwMCkge1xuICAgIHJldHVybiBgMCR7bn1gO1xuICB9XG4gIHJldHVybiBTdHJpbmcobik7XG59XG5cbmNvbnN0IHBhcnNlVGltZVN0YW1wID0gKGlucHV0OiBzdHJpbmcpID0+IHtcbiAgY29uc3QgbSA9IHJlZ2V4VGltZVNwYW4uZXhlYyhpbnB1dCk7XG4gIGlmICghbSkge1xuICAgIHRocm93IG5ldyBFcnJvcihgaW52YWxpZCB0aW1lc3RhbXAgdmFsdWU6IFwiJHtpbnB1dH1cImApO1xuICB9XG4gIGxldCBtaWxsaXNlY29uZHMgPSBtWzldID8gcGFyc2VJbnQobVs5XSwgMTApICogcG93MTAoMyAtIG1bOV0ubGVuZ3RoKSA6IDA7XG4gIG1pbGxpc2Vjb25kcyArPSAocGFyc2VJbnQobVs3XSwgMTApIHx8IDApICogVGltZVNwYW4ubWlsbGlzZWNvbmRzSW5TZWNvbmQ7XG4gIG1pbGxpc2Vjb25kcyArPSAocGFyc2VJbnQobVs1XSwgMTApIHx8IDApICogVGltZVNwYW4ubWlsbGlzZWNvbmRzSW5NaW51dGU7XG4gIG1pbGxpc2Vjb25kcyArPSAocGFyc2VJbnQobVs0XSwgMTApIHx8IDApICogVGltZVNwYW4ubWlsbGlzZWNvbmRzSW5Ib3VyO1xuICBtaWxsaXNlY29uZHMgKz0gKHBhcnNlSW50KG1bM10sIDEwKSB8fCAwKSAqIFRpbWVTcGFuLm1pbGxpc2Vjb25kc0luRGF5O1xuICBpZiAoJy0nID09PSBtWzFdKSB7XG4gICAgbWlsbGlzZWNvbmRzID0gLW1pbGxpc2Vjb25kcztcbiAgfVxuICByZXR1cm4gbWlsbGlzZWNvbmRzO1xufVxuXG5leHBvcnQgY2xhc3MgVGltZVNwYW4gaW1wbGVtZW50cyBFcXVhdGFibGU8VGltZVNwYW4+LCBDb21wYXJhYmxlPFRpbWVTcGFuPiB7XG4gIHN0YXRpYyByZWFkb25seSBtaWxsaXNlY29uZHNJblNlY29uZCA9IDEwMDA7XG4gIHN0YXRpYyByZWFkb25seSBtaWxsaXNlY29uZHNJbk1pbnV0ZSA9IDYwMDAwO1xuICBzdGF0aWMgcmVhZG9ubHkgbWlsbGlzZWNvbmRzSW5Ib3VyID0gMzYwMDAwMDtcbiAgc3RhdGljIHJlYWRvbmx5IG1pbGxpc2Vjb25kc0luRGF5ID0gODY0MDAwMDA7XG4gIHByaXZhdGUgcmVhZG9ubHkgdmFsdWU6IG51bWJlclxuICBnZXQgbWlsbGlzZWNvbmRzKCkgeyByZXR1cm4gdGhpcy52YWx1ZSAlIFRpbWVTcGFuLm1pbGxpc2Vjb25kc0luU2Vjb25kOyB9XG4gIGdldCBzZWNvbmRzKCkgeyByZXR1cm4gTWF0aC5mbG9vcih0aGlzLnRvdGFsU2Vjb25kcykgJSA2MDsgfVxuICBnZXQgbWludXRlcygpIHsgcmV0dXJuIE1hdGguZmxvb3IodGhpcy50b3RhbE1pbnV0ZXMpICUgNjA7IH1cbiAgZ2V0IGhvdXJzKCkgeyByZXR1cm4gTWF0aC5mbG9vcih0aGlzLnRvdGFsSG91cnMpICUgMjQ7IH1cbiAgZ2V0IGRheXMoKSB7IHJldHVybiBNYXRoLmZsb29yKHRoaXMudG90YWxEYXlzKTsgfVxuICBnZXQgdG90YWxNaWxsaXNlY29uZHMoKSB7IHJldHVybiB0aGlzLnZhbHVlOyB9XG4gIGdldCB0b3RhbFNlY29uZHMoKSB7IHJldHVybiB0aGlzLnZhbHVlIC8gVGltZVNwYW4ubWlsbGlzZWNvbmRzSW5TZWNvbmQ7IH1cbiAgZ2V0IHRvdGFsTWludXRlcygpIHsgcmV0dXJuIHRoaXMudmFsdWUgLyBUaW1lU3Bhbi5taWxsaXNlY29uZHNJbk1pbnV0ZTsgfVxuICBnZXQgdG90YWxIb3VycygpIHsgcmV0dXJuIHRoaXMudmFsdWUgLyBUaW1lU3Bhbi5taWxsaXNlY29uZHNJbkhvdXI7IH1cbiAgZ2V0IHRvdGFsRGF5cygpIHsgcmV0dXJuIHRoaXMudmFsdWUgLyBUaW1lU3Bhbi5taWxsaXNlY29uZHNJbkRheTsgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGVzIHRpbWVzcGFuIGZvciB0aGUgc3BlY2lmaWVkIGFtb3VudCBvZiBtaWxsaXNlY29uZHMuXG4gICAqIEBwYXJhbSBtaWxsaXNlY29uZHMgQW1vdW50IG9mIG1pbGxpc2Vjb25kcy5cbiAgICovXG4gIGNvbnN0cnVjdG9yKG1pbGxpc2Vjb25kczogbnVtYmVyKTtcblxuICAvKipcbiAgICogQ3JlYXRlcyB0aW1lc3BhbiBieSBwYXJzaW5nIGl0cyBzdHJpbmcgcmVwcmVzZW50YXRpb24uXG4gICAqIEBwYXJhbSBpbnB1dCBTdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgdGhlIHRpbWVzcGFuLlxuICAgKi9cbiAgY29uc3RydWN0b3IoaW5wdXQ6IHN0cmluZyk7XG5cbiAgY29uc3RydWN0b3Ioc291cmNlOiBudW1iZXJ8c3RyaW5nKSB7XG4gICAgaWYgKCdudW1iZXInID09PSB0eXBlb2Ygc291cmNlKSB7XG4gICAgICB0aGlzLnZhbHVlID0gc291cmNlO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnZhbHVlID0gcGFyc2VUaW1lU3RhbXAoc291cmNlKTtcbiAgICB9XG4gIH1cbiAgYWJzKCkge1xuICAgIHJldHVybiBuZXcgVGltZVNwYW4oTWF0aC5hYnModGhpcy52YWx1ZSkpO1xuICB9XG4gIGFkZE1pbGxpc2Vjb25kcyhtaWxsaXNlY29uZHM6IG51bWJlcikge1xuICAgIHJldHVybiBuZXcgVGltZVNwYW4odGhpcy52YWx1ZSArIG1pbGxpc2Vjb25kcyk7XG4gIH1cbiAgYWRkU2Vjb25kcyhzZWNvbmRzOiBudW1iZXIpIHtcbiAgICByZXR1cm4gdGhpcy5hZGRNaWxsaXNlY29uZHMoc2Vjb25kcyAqIFRpbWVTcGFuLm1pbGxpc2Vjb25kc0luU2Vjb25kKTtcbiAgfVxuICBhZGRNaW51dGVzKG1pbnV0ZXM6IG51bWJlcikge1xuICAgIHJldHVybiB0aGlzLmFkZE1pbGxpc2Vjb25kcyhtaW51dGVzICogVGltZVNwYW4ubWlsbGlzZWNvbmRzSW5NaW51dGUpO1xuICB9XG4gIGFkZEhvdXJzKGhvdXJzOiBudW1iZXIpIHtcbiAgICByZXR1cm4gdGhpcy5hZGRNaWxsaXNlY29uZHMoaG91cnMgKiBUaW1lU3Bhbi5taWxsaXNlY29uZHNJbkhvdXIpO1xuICB9XG4gIGFkZERheXMoZGF5czogbnVtYmVyKSB7XG4gICAgcmV0dXJuIHRoaXMuYWRkTWlsbGlzZWNvbmRzKGRheXMgKiBUaW1lU3Bhbi5taWxsaXNlY29uZHNJbkRheSk7XG4gIH1cbiAgYWRkKHZhbHVlOiBUaW1lU3BhbnxudW1iZXIpIHtcbiAgICBjb25zdCBtaWxsaXNlY29uZHMgPSB2YWx1ZSBpbnN0YW5jZW9mIFRpbWVTcGFuID8gdmFsdWUudG90YWxNaWxsaXNlY29uZHMgOiB2YWx1ZTtcbiAgICByZXR1cm4gdGhpcy5hZGRNaWxsaXNlY29uZHMobWlsbGlzZWNvbmRzKTtcbiAgfVxuICBuZWcoKSB7XG4gICAgcmV0dXJuIG5ldyBUaW1lU3BhbigtMSAqIHRoaXMudmFsdWUpO1xuICB9XG4gIHN1Yk1pbGxpc2Vjb25kcyhtaWxsaXNlY29uZHM6IG51bWJlcikge1xuICAgIHJldHVybiBuZXcgVGltZVNwYW4odGhpcy52YWx1ZSAtIG1pbGxpc2Vjb25kcyk7XG4gIH1cbiAgc3ViU2Vjb25kcyhzZWNvbmRzOiBudW1iZXIpIHtcbiAgICByZXR1cm4gdGhpcy5zdWJNaWxsaXNlY29uZHMoc2Vjb25kcyAqIFRpbWVTcGFuLm1pbGxpc2Vjb25kc0luU2Vjb25kKTtcbiAgfVxuICBzdWJNaW51dGVzKG1pbnV0ZXM6IG51bWJlcikge1xuICAgIHJldHVybiB0aGlzLnN1Yk1pbGxpc2Vjb25kcyhtaW51dGVzICogVGltZVNwYW4ubWlsbGlzZWNvbmRzSW5NaW51dGUpO1xuICB9XG4gIHN1YkhvdXJzKGhvdXJzOiBudW1iZXIpIHtcbiAgICByZXR1cm4gdGhpcy5zdWJNaWxsaXNlY29uZHMoaG91cnMgKiBUaW1lU3Bhbi5taWxsaXNlY29uZHNJbkhvdXIpO1xuICB9XG4gIHN1YkRheXMoZGF5czogbnVtYmVyKSB7XG4gICAgcmV0dXJuIHRoaXMuc3ViTWlsbGlzZWNvbmRzKGRheXMgKiBUaW1lU3Bhbi5taWxsaXNlY29uZHNJbkRheSk7XG4gIH1cbiAgc3ViKHZhbHVlOiBUaW1lU3BhbnxudW1iZXIpIHtcbiAgICBjb25zdCBtaWxsaXNlY29uZHMgPSB2YWx1ZSBpbnN0YW5jZW9mIFRpbWVTcGFuID8gdmFsdWUudG90YWxNaWxsaXNlY29uZHMgOiB2YWx1ZTtcbiAgICByZXR1cm4gdGhpcy5zdWJNaWxsaXNlY29uZHMobWlsbGlzZWNvbmRzKTtcbiAgfVxuXG4gIGVxdWFsc1RvKG90aGVyOiBUaW1lU3Bhbikge1xuICAgIHJldHVybiB0aGlzLnZhbHVlID09PSBvdGhlci52YWx1ZTtcbiAgfVxuXG4gIGNvbXBhcmVUbyhvdGhlcjogVGltZVNwYW4pIHtcbiAgICByZXR1cm4gdGhpcy52YWx1ZSA+IG90aGVyLnZhbHVlID8gMSA6ICh0aGlzLnZhbHVlID09PSBvdGhlci52YWx1ZSA/IDAgOiAtMSk7XG4gIH1cblxuICB0b1N0cmluZygpIHtcbiAgICBpZiAodGhpcy52YWx1ZSA8IDApIHtcbiAgICAgIHJldHVybiBgLSR7dGhpcy5hYnMoKX1gO1xuICAgIH1cbiAgICBjb25zdCBkYXlzID0gdGhpcy5kYXlzO1xuICAgIGNvbnN0IGhvdXJzID0gdGhpcy5ob3VycztcbiAgICBjb25zdCBtaW51dGVzID0gdGhpcy5taW51dGVzO1xuICAgIGNvbnN0IHNlY29uZHMgPSB0aGlzLnNlY29uZHM7XG4gICAgY29uc3QgbWlsbGlzZWNvbmRzID0gdGhpcy5taWxsaXNlY29uZHM7XG4gICAgaWYgKGRheXMpIHtcbiAgICAgIGlmIChzZWNvbmRzIHx8ICFtaWxsaXNlY29uZHMpIHtcbiAgICAgICAgcmV0dXJuIGAke2RheXN9LiR7aG91cnN9LiR7bWludXRlc30uJHtzZWNvbmRzfWA7XG4gICAgICB9XG4gICAgICBpZiAobWlsbGlzZWNvbmRzKSB7XG4gICAgICAgIHJldHVybiBgJHtkYXlzfS4ke2hvdXJzfS4ke21pbnV0ZXN9LiR7c2Vjb25kc30uJHtwYWQzKG1pbGxpc2Vjb25kcyl9YDtcbiAgICAgIH1cbiAgICAgIHJldHVybiBgJHtkYXlzfS4ke2hvdXJzfS4ke21pbnV0ZXN9YDtcbiAgICB9XG4gICAgaWYgKHNlY29uZHMgfHwgIW1pbGxpc2Vjb25kcykge1xuICAgICAgcmV0dXJuIGAke2hvdXJzfS4ke21pbnV0ZXN9LiR7c2Vjb25kc31gO1xuICAgIH1cbiAgICBpZiAobWlsbGlzZWNvbmRzKSB7XG4gICAgICByZXR1cm4gYCR7aG91cnN9LiR7bWludXRlc30uJHtzZWNvbmRzfS4ke3BhZDMobWlsbGlzZWNvbmRzKX1gO1xuICAgIH1cbiAgICByZXR1cm4gYCR7aG91cnN9LiR7bWludXRlc31gO1xuICB9XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgRGF0ZVRpbWVJbml0IHtcbiAgeWVhcj86IG51bWJlcjtcbiAgbW9udGg/OiBudW1iZXI7XG4gIGRheT86IG51bWJlcjtcbiAgaG91cnM/OiBudW1iZXI7XG4gIG1pbnV0ZXM/OiBudW1iZXI7XG4gIHNlY29uZHM/OiBudW1iZXI7XG4gIG1pbGxpc2Vjb25kcz86IG51bWJlcjtcbn1cblxuZXhwb3J0IGNsYXNzIERhdGVUaW1lIGltcGxlbWVudHMgRXF1YXRhYmxlPERhdGVUaW1lPiwgQ29tcGFyYWJsZTxEYXRlVGltZT4ge1xuICAvKipcbiAgICogUmV0dXJucyBhbW91bnQgb2YgZGF5cyBpbiB0aGUgc3BlY2lmaWVkIG1vbnRoLlxuICAgKiBAcGFyYW0gbW9udGggTW9udGguXG4gICAqIEBwYXJhbSB5ZWFyIFllYXIuXG4gICAqL1xuICBzdGF0aWMgZ2V0TW9udGhMZW5ndGgobW9udGg6IG51bWJlciwgeWVhcjogbnVtYmVyKSB7XG4gICAgaWYgKG1vbnRoIDwgMSB8fCBtb250aCA+IDEyKSB7XG4gICAgICAgIHRocm93IG5ldyBSYW5nZUVycm9yKCdtb250aCBvdXQgb2YgcmFuZ2UnKTtcbiAgICB9XG4gICAgaWYgKG1vbnRoICE9PSAyKSB7XG4gICAgICAgIHJldHVybiBtb250aExlbmd0aHNbbW9udGggLSAxXTtcbiAgICB9XG4gICAgcmV0dXJuICgwID09PSB5ZWFyICUgNCAmJiAoMCAhPT0geWVhciAlIDEwMCB8fCAwID09PSB5ZWFyICUgNDAwKSkgPyAyOSA6IDI4O1xufVxuXG4gIHByaXZhdGUgcmVhZG9ubHkgc291cmNlOiBEYXRlXG4gIGdldCBpc1ZhbGlkKCkgeyByZXR1cm4gIWlzTmFOKHRoaXMuc291cmNlLmdldFRpbWUoKSk7IH1cbiAgZ2V0IHllYXIoKSB7IHJldHVybiB0aGlzLnNvdXJjZS5nZXRGdWxsWWVhcigpOyB9XG4gIGdldCBtb250aCgpIHsgcmV0dXJuIHRoaXMuc291cmNlLmdldE1vbnRoKCkgKyAxOyB9XG4gIGdldCBkYXkoKSB7IHJldHVybiB0aGlzLnNvdXJjZS5nZXREYXRlKCk7IH1cbiAgZ2V0IGRheU9mV2VlaygpIHsgcmV0dXJuIHRoaXMuc291cmNlLmdldERheSgpOyB9XG4gIGdldCBob3VycygpIHsgcmV0dXJuIHRoaXMuc291cmNlLmdldEhvdXJzKCk7IH1cbiAgZ2V0IG1pbnV0ZXMoKSB7IHJldHVybiB0aGlzLnNvdXJjZS5nZXRNaW51dGVzKCk7IH1cbiAgZ2V0IHNlY29uZHMoKSB7IHJldHVybiB0aGlzLnNvdXJjZS5nZXRTZWNvbmRzKCk7IH1cbiAgZ2V0IG1pbGxpc2Vjb25kcygpIHsgcmV0dXJuIHRoaXMuc291cmNlLmdldE1pbGxpc2Vjb25kcygpOyB9XG5cbiAgLyoqIENyZWF0ZXMgbmV3IGluc3RhbmNlIG9mIGRhdGV0aW1lIGZvciBhY3R1YWwgZGF0ZSBhbmQgdGltZS4gKi9cbiAgY29uc3RydWN0b3IoKTtcblxuICAvKipcbiAgICogQ3JlYXRlcyBuZXcgaW5zdGFuY2Ugb2YgZGF0ZXRpbWUgZnJvbSB0aGUgc3BlY2lmaWVkIGRhdGUuXG4gICAqIEBwYXJhbSBzb3VyY2UgRGF0ZSBvYmplY3QgdG8gdXNlLlxuICAgKi9cbiAgY29uc3RydWN0b3Ioc291cmNlOiBEYXRlKTtcblxuICAvKipcbiAgICogQ3JlYXRlcyBuZXcgaW5zdGFuY2Ugb2YgZGF0ZXRpbWUgZnJvbSB0aGUgc3BlY2lmaWVkIEpTT04gc3RyaW5nIHJlcHJlc2VudGluZyBkYXRlLlxuICAgKiBAcGFyYW0ganNvbiBKU09OIHN0cmluZyByZXByZXNlbnRpbmcgZGF0ZS5cbiAgICovXG4gIGNvbnN0cnVjdG9yKGpzb246IHN0cmluZyk7XG5cbiAgLyoqXG4gICAqIENyZWF0ZXMgbmV3IGluc3RhbmNlIG9mIGRhdGV0aW1lIGZyb20gdGhlIHNwZWNpZmllZCBhbW91bnQgb2YgbWlsbGlzZWNvbmRzIGZyb20gMTk3MCBqYW4gMSBVVEMuXG4gICAqIEBwYXJhbSBzb3VyY2UgQW1vdW50IG9mIG1pbGxpc2Vjb25kcyBmcm9tIDE5NzAgamFuIDEgVVRDLlxuICAgKi9cbiAgY29uc3RydWN0b3IobWlsbGlzZWNvbmRzOiBudW1iZXIpO1xuXG4gIC8qKlxuICAgKiBDcmVhdGVzIG5ldyBpbnN0YW5jZSBvZiBkYXRldGltZSBmcm9tIHRoZSBzcGVjaWZpZWQgaW5pdGlhbGl6ZXIuXG4gICAqIEBwYXJhbSBzb3VyY2UgSW5pdGlhbGl6ZXIgb2JqZWN0IHRvIHVzZS5cbiAgICovXG4gIGNvbnN0cnVjdG9yKGluaXQ6IERhdGVUaW1lSW5pdCk7XG5cbiAgY29uc3RydWN0b3IgKHNvdXJjZT86IERhdGV8c3RyaW5nfG51bWJlcnxEYXRlVGltZUluaXQpIHtcbiAgICBpZiAodW5kZWZpbmVkID09PSBzb3VyY2UgfHwgbnVsbCA9PT0gc291cmNlKSB7XG4gICAgICB0aGlzLnNvdXJjZSA9IG5ldyBEYXRlKCk7XG4gICAgfSBlbHNlIGlmICgnc3RyaW5nJyA9PT0gdHlwZW9mIHNvdXJjZSkge1xuICAgICAgdGhpcy5zb3VyY2UgPSBkYXRlRnJvbUpzb24oc291cmNlKTtcbiAgICB9IGVsc2UgaWYgKCdudW1iZXInID09PSB0eXBlb2Ygc291cmNlKSB7XG4gICAgICB0aGlzLnNvdXJjZSA9IGRhdGVGcm9tVGltZShzb3VyY2UpO1xuICAgIH0gZWxzZSBpZiAoc291cmNlIGluc3RhbmNlb2YgRGF0ZSkge1xuICAgICAgdGhpcy5zb3VyY2UgPSBzb3VyY2U7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIGFzc3VtZSBpbml0XG4gICAgICBjb25zdCBpbml0ID0gPERhdGVUaW1lSW5pdD5zb3VyY2U7XG4gICAgICB0aGlzLnNvdXJjZSA9IG5ldyBEYXRlKGluaXQueWVhciB8fCBuZXcgRGF0ZSgpLmdldEZ1bGxZZWFyKCksIGluaXQubW9udGggPyBpbml0Lm1vbnRoIC0gMSA6IDAsIGluaXQuZGF5IHx8IDEsIGluaXQuaG91cnMgfHwgMCwgaW5pdC5taW51dGVzIHx8IDAsIGluaXQuc2Vjb25kcyB8fCAwLCBpbml0Lm1pbGxpc2Vjb25kcyB8fCAwKTtcbiAgICB9XG4gIH1cblxuICBlcXVhbHNUbyhvdGhlcjogRGF0ZVRpbWUpIHtcbiAgICByZXR1cm4gdGhpcy5zb3VyY2UuZ2V0VGltZSgpID09PSBvdGhlci5zb3VyY2UuZ2V0VGltZSgpO1xuICB9XG5cbiAgY29tcGFyZVRvKG90aGVyOiBEYXRlVGltZSkge1xuICAgIHJldHVybiB0aGlzLnNvdXJjZSA8IG90aGVyLnNvdXJjZSA/IC0xIDogKHRoaXMuZXF1YWxzVG8ob3RoZXIpID8gMCA6IDEpO1xuICB9XG5cbiAgYWRkTWlsbGlzZWNvbmRzKG1pbGxpc2Vjb25kczogbnVtYmVyKSB7XG4gICAgY29uc3QgcmVzID0gZGF0ZUZyb21UaW1lKHRoaXMuc291cmNlLmdldFRpbWUoKSArIG1pbGxpc2Vjb25kcyk7XG4gICAgY29uc3Qgb2Zmc2V0RGVsdGEgPSB0aGlzLnNvdXJjZS5nZXRUaW1lem9uZU9mZnNldCgpIC0gcmVzLmdldFRpbWV6b25lT2Zmc2V0KCk7XG4gICAgaWYgKG9mZnNldERlbHRhICE9PSAwKSB7XG4gICAgICAgIGNvbnN0IGFkanVzdCA9IG9mZnNldERlbHRhICogVGltZVNwYW4ubWlsbGlzZWNvbmRzSW5NaW51dGU7XG4gICAgICAgIHJlcy5zZXRUaW1lKHJlcy5nZXRUaW1lKCkgLSBhZGp1c3QpO1xuICAgIH1cbiAgICByZXR1cm4gbmV3IERhdGVUaW1lKHJlcyk7XG4gIH1cblxuICBhZGRTZWNvbmRzKHNlY29uZHM6IG51bWJlcikge1xuICAgIHJldHVybiB0aGlzLmFkZE1pbGxpc2Vjb25kcyhzZWNvbmRzICogVGltZVNwYW4ubWlsbGlzZWNvbmRzSW5TZWNvbmQpO1xuICB9XG5cbiAgYWRkTWludXRlcyhtaW51dGVzOiBudW1iZXIpIHtcbiAgICByZXR1cm4gdGhpcy5hZGRNaWxsaXNlY29uZHMobWludXRlcyAqIFRpbWVTcGFuLm1pbGxpc2Vjb25kc0luTWludXRlKTtcbiAgfVxuXG4gIGFkZEhvdXJzKGhvdXJzOiBudW1iZXIpIHtcbiAgICByZXR1cm4gdGhpcy5hZGRNaWxsaXNlY29uZHMoaG91cnMgKiBUaW1lU3Bhbi5taWxsaXNlY29uZHNJbkhvdXIpO1xuICB9XG5cbiAgYWRkRGF5cyhkYXlzOiBudW1iZXIpIHtcbiAgICByZXR1cm4gdGhpcy5hZGRNaWxsaXNlY29uZHMoZGF5cyAqIFRpbWVTcGFuLm1pbGxpc2Vjb25kc0luRGF5KTtcbiAgfVxuXG4gIGFkZE1vbnRocyhtb250aHM6IG51bWJlcikge1xuICAgIGlmICgwID09PSBtb250aHMpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYWRkRGF5cygwKTtcbiAgICB9XG4gICAgaWYgKDAgPCBtb250aHMpIHtcbiAgICAgIGNvbnN0IGZ1bGwgPSBNYXRoLmZsb29yKG1vbnRocykgKyAodGhpcy5tb250aCAtIDEpO1xuICAgICAgY29uc3QgZm0gPSBmdWxsICUgMTI7XG4gICAgICBjb25zdCBmeSA9IE1hdGguZmxvb3IoZnVsbCAvIDEyKTtcbiAgICAgIGxldCByZXMgPSBuZXcgRGF0ZVRpbWUoe1xuICAgICAgICB5ZWFyOiB0aGlzLnllYXIgKyBmeSxcbiAgICAgICAgbW9udGg6IGZtICsgMSxcbiAgICAgICAgZGF5OiBNYXRoLm1pbihEYXRlVGltZS5nZXRNb250aExlbmd0aChmbSArIDEsIHRoaXMueWVhciArIGZ5KSwgdGhpcy5kYXkpLFxuICAgICAgICBob3VyczogdGhpcy5ob3VycyxcbiAgICAgICAgbWludXRlczogdGhpcy5taW51dGVzLFxuICAgICAgICBzZWNvbmRzOiB0aGlzLnNlY29uZHMsXG4gICAgICAgIG1pbGxpc2Vjb25kczogdGhpcy5taWxsaXNlY29uZHNcbiAgICAgIH0pO1xuICAgICAgY29uc3QgcGFydCA9IG1vbnRocyAlIDE7XG4gICAgICBpZiAoMCA9PT0gcGFydCkge1xuICAgICAgICByZXR1cm4gcmVzO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHJlcy5hZGREYXlzKERhdGVUaW1lLmdldE1vbnRoTGVuZ3RoKHJlcy5tb250aCwgcmVzLnllYXIpICogcGFydCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnN0IGFicyA9IE1hdGguYWJzKG1vbnRocyk7XG4gICAgICBsZXQgbSA9ICh0aGlzLm1vbnRoIC0gMSkgLSBNYXRoLmZsb29yKGFicyk7XG4gICAgICBsZXQgeSA9IHRoaXMueWVhcjtcbiAgICAgIHdoaWxlICgwID4gbSkge1xuICAgICAgICB5ID0geSAtIDE7XG4gICAgICAgIG0gPSBtICsgMTI7XG4gICAgICB9XG4gICAgICBjb25zdCBwYXJ0ID0gYWJzICUgMTtcbiAgICAgIGlmICgwID09PSBwYXJ0KSB7XG4gICAgICAgIHJldHVybiBuZXcgRGF0ZVRpbWUoe1xuICAgICAgICAgIHllYXI6IHksXG4gICAgICAgICAgbW9udGg6IG0gKyAxLFxuICAgICAgICAgIGRheTogdGhpcy5kYXksXG4gICAgICAgICAgaG91cnM6IHRoaXMuaG91cnMsXG4gICAgICAgICAgbWludXRlczogdGhpcy5taW51dGVzLFxuICAgICAgICAgIHNlY29uZHM6IHRoaXMuc2Vjb25kcyxcbiAgICAgICAgICBtaWxsaXNlY29uZHM6IHRoaXMubWlsbGlzZWNvbmRzXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgaWYgKDAgPT09IG0pIHtcbiAgICAgICAgICB5ID0geSAtIDE7XG4gICAgICAgICAgbSA9IDExO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBtID0gbSAtIDE7XG4gICAgICB9XG4gICAgICBjb25zdCBkYXlzID0gRGF0ZVRpbWUuZ2V0TW9udGhMZW5ndGgobSArIDEsIHkpO1xuICAgICAgY29uc3QgdG9BZGQgPSBkYXlzICogKDEgLSBwYXJ0KTtcbiAgICAgIHJldHVybiBuZXcgRGF0ZVRpbWUoe1xuICAgICAgICB5ZWFyOiB5LFxuICAgICAgICBtb250aDogbSxcbiAgICAgICAgZGF5OiB0aGlzLmRheSxcbiAgICAgICAgaG91cnM6IHRoaXMuaG91cnMsXG4gICAgICAgIG1pbnV0ZXM6IHRoaXMubWludXRlcyxcbiAgICAgICAgc2Vjb25kczogdGhpcy5zZWNvbmRzLFxuICAgICAgICBtaWxsaXNlY29uZHM6IHRoaXMubWlsbGlzZWNvbmRzXG4gICAgICB9KS5hZGREYXlzKHRvQWRkKTtcbiAgICB9XG4gIH1cbiAgYWRkKHRpbWVTcGFuOiBUaW1lU3Bhbik6IERhdGVUaW1lO1xuICBhZGQobWlsbGlzZWNvbmRzOiBudW1iZXIpOiBEYXRlVGltZTtcbiAgYWRkKHZhbHVlOiBUaW1lU3BhbnxudW1iZXIpIHtcbiAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBUaW1lU3Bhbikge1xuICAgICAgcmV0dXJuIHRoaXMuYWRkTWlsbGlzZWNvbmRzKHZhbHVlLnRvdGFsTWlsbGlzZWNvbmRzKTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuYWRkTWlsbGlzZWNvbmRzKHZhbHVlKTtcbiAgfVxuICBzdWJzdHJhY3Qob3RoZXI6IERhdGVUaW1lKTogVGltZVNwYW47XG4gIHN1YnN0cmFjdCh0aW1lc3BhbjogVGltZVNwYW4pOiBEYXRlVGltZTtcbiAgc3Vic3RyYWN0KG1pbGxpc2Vjb25kczogbnVtYmVyKTogRGF0ZVRpbWU7XG4gIHN1YnN0cmFjdCh2YWx1ZTogRGF0ZVRpbWV8VGltZVNwYW58bnVtYmVyKSB7XG4gICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgRGF0ZVRpbWUpIHtcbiAgICAgIHJldHVybiBuZXcgVGltZVNwYW4odGhpcy5zb3VyY2UuZ2V0VGltZSgpIC0gdmFsdWUuc291cmNlLmdldFRpbWUoKSk7XG4gICAgfVxuICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIFRpbWVTcGFuKSB7XG4gICAgICByZXR1cm4gdGhpcy5hZGQoLTEgKiB2YWx1ZS50b3RhbE1pbGxpc2Vjb25kcyk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLmFkZCgtMSAqIHZhbHVlKTtcbiAgfVxuICB0b0RhdGUoKSB7XG4gICAgY29uc3QgcmVzdWx0ID0gbmV3IERhdGUoKTtcbiAgICByZXN1bHQuc2V0VGltZSh0aGlzLnNvdXJjZS5nZXRUaW1lKCkpO1xuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cbn0iXX0=