const toSolidByte = (_, num) => {
    const n = parseInt(num, 16);
    return String.fromCharCode(n);
};
const regexNum = /%([0-9A-F]{2})/g;
export function toBase64String(input) {
    const fixed = encodeURIComponent(input).replace(regexNum, toSolidByte);
    return window.btoa(fixed);
}
export function fromBase64String(encoded) {
    const fixed = window.atob(encoded)
        .split('')
        .map(c => '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2))
        .join('');
    return decodeURIComponent(fixed);
}
const r = {
    text: /^[^\u0025]+/,
    percent: /^\u0025{2}/,
    arg: /^\u0025([+0\u0020\u002d]*)([0-9]*)(\.[0-9]+)?(b|d|i|f|s)/
};
const fun = {
    b(arg) {
        return arg ? 'true' : 'false';
    },
    d(arg) {
        const x = parseInt(arg, 10);
        const sign = (x < 0) ? '-' : (this.sign && !isNaN(x) ? '+' : '');
        return `${sign}${Math.abs(x)}`;
    },
    f(arg) {
        const x = parseFloat(arg);
        const sign = (x < 0) ? '-' : (this.sign && !isNaN(x) ? '+' : '');
        return (this.precision) ? `${sign}${Math.abs(x).toFixed(this.precision)}` : `${sign}${Math.abs(x)}`;
    },
    s(arg) { return arg; }
};
// aliases
Object.assign(fun, {
    i: fun.d
});
// cached fun
const sprintf = Object.assign(function (format, ...args) {
    if (undefined === format) {
        throw new Error('[sprintf] format must be specified');
    }
    const cache = sprintf.cache;
    if (!(cache[format] && Object.prototype.hasOwnProperty.call(cache, format))) {
        cache[format] = sprintf.parse(format);
    }
    return sprintf.format(cache[format], args);
}, {
    cache: Object.create(null),
    format: (items, args) => {
        return items.map(function (item) {
            var s, i, pad, arg;
            if ('string' === typeof item) {
                s = item;
            }
            else {
                arg = args.shift();
                s = (item.fun || (() => '')).call(item, arg);
                if (item.width) {
                    i = item.width - s.length;
                    if (i > 0) {
                        pad = (item.pad || ' ').repeat(i);
                        if (item.left) {
                            s = s + pad;
                        }
                        else {
                            s = pad + s;
                        }
                    }
                }
            }
            return s;
        }).join('');
    },
    parse: function (fmt) {
        const result = [];
        let rest = fmt;
        while (0 !== rest.length) {
            let m = r.text.exec(rest);
            if (m) {
                result.push(m[0]);
            }
            else {
                m = r.percent.exec(rest);
                if (m) {
                    result.push('%');
                }
                else {
                    m = r.arg.exec(rest);
                    if (m) {
                        const o = Object.create(null);
                        const flags = m[1];
                        const width = m[2];
                        const prec = m[3];
                        const ty = m[4];
                        const f = fun[ty];
                        if (!f) {
                            throw new Error('[sprintf] invalid type: ' + ty);
                        }
                        o.fun = f;
                        // flags feldolgoz√°sa
                        if (flags) {
                            if (-1 !== flags.indexOf('-')) {
                                o.left = true;
                            }
                            if (-1 !== flags.indexOf('+')) {
                                o.sign = true;
                            }
                        }
                        if (width) {
                            o.width = parseInt(width, 10);
                            if (-1 !== flags.indexOf('0')) {
                                o.pad = '0';
                            }
                            else {
                                o.pad = ' ';
                            }
                        }
                        if (prec) {
                            o.precision = parseInt(prec.substr(1), 10);
                        }
                        result.push(o);
                    }
                    else {
                        throw new Error('[sprintf] could not parse: ' + rest);
                    }
                }
            }
            rest = rest.substring(m[0].length);
        } // while
        return result;
    }
});
export { sprintf };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3RyaW5nLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL3N0cmluZy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxNQUFNLFdBQVcsR0FBRyxDQUFDLENBQVMsRUFBRSxHQUFXLEVBQUUsRUFBRTtJQUM3QyxNQUFNLENBQUMsR0FBRyxRQUFRLENBQUMsR0FBRyxFQUFFLEVBQUUsQ0FBQyxDQUFDO0lBQzVCLE9BQU8sTUFBTSxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUNoQyxDQUFDLENBQUE7QUFFRCxNQUFNLFFBQVEsR0FBRyxpQkFBaUIsQ0FBQztBQUVuQyxNQUFNLFVBQVUsY0FBYyxDQUFDLEtBQWE7SUFDMUMsTUFBTSxLQUFLLEdBQUcsa0JBQWtCLENBQUMsS0FBSyxDQUFDLENBQUMsT0FBTyxDQUFDLFFBQVEsRUFBRSxXQUFXLENBQUMsQ0FBQztJQUN2RSxPQUFPLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7QUFDNUIsQ0FBQztBQUVELE1BQU0sVUFBVSxnQkFBZ0IsQ0FBQyxPQUFlO0lBQzlDLE1BQU0sS0FBSyxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDO1NBQy9CLEtBQUssQ0FBQyxFQUFFLENBQUM7U0FDVCxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxJQUFJLEdBQUcsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztTQUMvRCxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUM7SUFDWixPQUFPLGtCQUFrQixDQUFDLEtBQUssQ0FBQyxDQUFDO0FBQ25DLENBQUM7QUFFRCxNQUFNLENBQUMsR0FBRztJQUNSLElBQUksRUFBRSxhQUFhO0lBQ25CLE9BQU8sRUFBRSxZQUFZO0lBQ3JCLEdBQUcsRUFBRSwwREFBMEQ7Q0FDaEUsQ0FBQztBQWVGLE1BQU0sR0FBRyxHQUFnQjtJQUN2QixDQUFDLENBQUMsR0FBUTtRQUNSLE9BQU8sR0FBRyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQztJQUNoQyxDQUFDO0lBQ0QsQ0FBQyxDQUFDLEdBQVE7UUFDTixNQUFNLENBQUMsR0FBRyxRQUFRLENBQUMsR0FBRyxFQUFFLEVBQUUsQ0FBQyxDQUFDO1FBQzVCLE1BQU0sSUFBSSxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQWlCLElBQUssQ0FBQyxJQUFJLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDbEYsT0FBTyxHQUFHLElBQUksR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7SUFDbkMsQ0FBQztJQUNELENBQUMsQ0FBRSxHQUFRO1FBQ1AsTUFBTSxDQUFDLEdBQUcsVUFBVSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQzFCLE1BQU0sSUFBSSxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQWlCLElBQUssQ0FBQyxJQUFJLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDbEYsT0FBTyxDQUFpQixJQUFLLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsSUFBSSxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFpQixJQUFLLENBQUMsU0FBUyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsR0FBRyxJQUFJLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDO0lBQzFJLENBQUM7SUFDRCxDQUFDLENBQUUsR0FBUSxJQUFZLE9BQU8sR0FBRyxDQUFDLENBQUMsQ0FBQztDQUNyQyxDQUFDO0FBQ0YsVUFBVTtBQUNWLE1BQU0sQ0FBQyxNQUFNLENBQUMsR0FBRyxFQUFFO0lBQ2pCLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQztDQUNULENBQUMsQ0FBQztBQWVILGFBQWE7QUFDYixNQUFNLE9BQU8sR0FBWSxNQUFNLENBQUMsTUFBTSxDQUNwQyxVQUFVLE1BQWMsRUFBRSxHQUFHLElBQVc7SUFDdEMsSUFBSSxTQUFTLEtBQUssTUFBTSxFQUFFO1FBQ3RCLE1BQU0sSUFBSSxLQUFLLENBQUMsb0NBQW9DLENBQUMsQ0FBQztLQUN6RDtJQUNELE1BQU0sS0FBSyxHQUFHLE9BQU8sQ0FBQyxLQUFLLENBQUM7SUFDNUIsSUFBSSxDQUFDLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxJQUFJLE1BQU0sQ0FBQyxTQUFTLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxLQUFLLEVBQUUsTUFBTSxDQUFDLENBQUMsRUFBRTtRQUN6RSxLQUFLLENBQUMsTUFBTSxDQUFDLEdBQUcsT0FBTyxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQztLQUN6QztJQUNELE9BQU8sT0FBTyxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLEVBQUUsSUFBSSxDQUFDLENBQUM7QUFDN0MsQ0FBQyxFQUFFO0lBQ0QsS0FBSyxFQUFFLE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDO0lBQzFCLE1BQU0sRUFBRSxDQUFDLEtBQWdCLEVBQUUsSUFBVyxFQUFVLEVBQUU7UUFDaEQsT0FBTyxLQUFLLENBQUMsR0FBRyxDQUFDLFVBQVUsSUFBSTtZQUM3QixJQUFJLENBQUMsRUFDRCxDQUFDLEVBQ0QsR0FBRyxFQUNILEdBQUcsQ0FBQztZQUNSLElBQUksUUFBUSxLQUFLLE9BQU8sSUFBSSxFQUFFO2dCQUMxQixDQUFDLEdBQUcsSUFBSSxDQUFDO2FBQ1o7aUJBQU07Z0JBQ0gsR0FBRyxHQUFHLElBQUksQ0FBQyxLQUFLLEVBQUUsQ0FBQztnQkFDbkIsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLEdBQUcsSUFBSSxDQUFDLEdBQUcsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxHQUFHLENBQUMsQ0FBQztnQkFDN0MsSUFBSSxJQUFJLENBQUMsS0FBSyxFQUFFO29CQUNaLENBQUMsR0FBRyxJQUFJLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQyxNQUFNLENBQUM7b0JBQzFCLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRTt3QkFDUCxHQUFHLEdBQUcsQ0FBQyxJQUFJLENBQUMsR0FBRyxJQUFJLEdBQUcsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQzt3QkFDbEMsSUFBSSxJQUFJLENBQUMsSUFBSSxFQUFFOzRCQUNYLENBQUMsR0FBRyxDQUFDLEdBQUcsR0FBRyxDQUFDO3lCQUNmOzZCQUFNOzRCQUNILENBQUMsR0FBRyxHQUFHLEdBQUcsQ0FBQyxDQUFDO3lCQUNmO3FCQUNKO2lCQUNKO2FBQ0o7WUFDRCxPQUFPLENBQUMsQ0FBQztRQUNYLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQztJQUNkLENBQUM7SUFDRCxLQUFLLEVBQUUsVUFBVSxHQUFXO1FBQzFCLE1BQU0sTUFBTSxHQUFjLEVBQUUsQ0FBQztRQUM3QixJQUFJLElBQUksR0FBRyxHQUFHLENBQUM7UUFDZixPQUFPLENBQUMsS0FBSyxJQUFJLENBQUMsTUFBTSxFQUFFO1lBQ3RCLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQzFCLElBQUksQ0FBQyxFQUFFO2dCQUNILE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7YUFDckI7aUJBQU07Z0JBQ0gsQ0FBQyxHQUFHLENBQUMsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO2dCQUN6QixJQUFJLENBQUMsRUFBRTtvQkFDSCxNQUFNLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO2lCQUNwQjtxQkFBTTtvQkFDSCxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7b0JBQ3JCLElBQUksQ0FBQyxFQUFFO3dCQUNILE1BQU0sQ0FBQyxHQUFrQixNQUFNLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDO3dCQUM3QyxNQUFNLEtBQUssR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7d0JBQ25CLE1BQU0sS0FBSyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQzt3QkFDbkIsTUFBTSxJQUFJLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO3dCQUNsQixNQUFNLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7d0JBQ2hCLE1BQU0sQ0FBQyxHQUFHLEdBQUcsQ0FBQyxFQUFFLENBQUMsQ0FBQzt3QkFDbEIsSUFBSSxDQUFDLENBQUMsRUFBRTs0QkFDSixNQUFNLElBQUksS0FBSyxDQUFDLDBCQUEwQixHQUFHLEVBQUUsQ0FBQyxDQUFDO3lCQUNwRDt3QkFDRCxDQUFDLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQzt3QkFDVixxQkFBcUI7d0JBQ3JCLElBQUksS0FBSyxFQUFFOzRCQUNQLElBQUksQ0FBQyxDQUFDLEtBQUssS0FBSyxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsRUFBRTtnQ0FDM0IsQ0FBQyxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7NkJBQ2pCOzRCQUNELElBQUksQ0FBQyxDQUFDLEtBQUssS0FBSyxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsRUFBRTtnQ0FDM0IsQ0FBQyxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7NkJBQ2pCO3lCQUNKO3dCQUNELElBQUksS0FBSyxFQUFFOzRCQUNQLENBQUMsQ0FBQyxLQUFLLEdBQUcsUUFBUSxDQUFDLEtBQUssRUFBRSxFQUFFLENBQUMsQ0FBQzs0QkFDOUIsSUFBSSxDQUFDLENBQUMsS0FBSyxLQUFLLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxFQUFFO2dDQUMzQixDQUFDLENBQUMsR0FBRyxHQUFHLEdBQUcsQ0FBQzs2QkFDZjtpQ0FBTTtnQ0FDSCxDQUFDLENBQUMsR0FBRyxHQUFHLEdBQUcsQ0FBQzs2QkFDZjt5QkFDSjt3QkFDRCxJQUFJLElBQUksRUFBRTs0QkFDTixDQUFDLENBQUMsU0FBUyxHQUFHLFFBQVEsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDO3lCQUM5Qzt3QkFDRCxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO3FCQUNsQjt5QkFBTTt3QkFDSCxNQUFNLElBQUksS0FBSyxDQUFDLDZCQUE2QixHQUFHLElBQUksQ0FBQyxDQUFDO3FCQUN6RDtpQkFDSjthQUNKO1lBQ0QsSUFBSSxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1NBQ3RDLENBQUMsUUFBUTtRQUNWLE9BQU8sTUFBTSxDQUFDO0lBQ2hCLENBQUM7Q0FDRixDQUNGLENBQUM7QUFFRixPQUFPLEVBQUUsT0FBTyxFQUFFLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCB0b1NvbGlkQnl0ZSA9IChfOiBzdHJpbmcsIG51bTogc3RyaW5nKSA9PiB7XG4gIGNvbnN0IG4gPSBwYXJzZUludChudW0sIDE2KTtcbiAgcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUobik7XG59XG5cbmNvbnN0IHJlZ2V4TnVtID0gLyUoWzAtOUEtRl17Mn0pL2c7XG5cbmV4cG9ydCBmdW5jdGlvbiB0b0Jhc2U2NFN0cmluZyhpbnB1dDogc3RyaW5nKSB7XG4gIGNvbnN0IGZpeGVkID0gZW5jb2RlVVJJQ29tcG9uZW50KGlucHV0KS5yZXBsYWNlKHJlZ2V4TnVtLCB0b1NvbGlkQnl0ZSk7XG4gIHJldHVybiB3aW5kb3cuYnRvYShmaXhlZCk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBmcm9tQmFzZTY0U3RyaW5nKGVuY29kZWQ6IHN0cmluZykge1xuICBjb25zdCBmaXhlZCA9IHdpbmRvdy5hdG9iKGVuY29kZWQpXG4gICAgLnNwbGl0KCcnKVxuICAgIC5tYXAoYyA9PiAnJScgKyAoJzAwJyArIGMuY2hhckNvZGVBdCgwKS50b1N0cmluZygxNikpLnNsaWNlKC0yKSlcbiAgICAuam9pbignJyk7XG4gIHJldHVybiBkZWNvZGVVUklDb21wb25lbnQoZml4ZWQpO1xufVxuXG5jb25zdCByID0ge1xuICB0ZXh0OiAvXlteXFx1MDAyNV0rLyxcbiAgcGVyY2VudDogL15cXHUwMDI1ezJ9LyxcbiAgYXJnOiAvXlxcdTAwMjUoWyswXFx1MDAyMFxcdTAwMmRdKikoWzAtOV0qKShcXC5bMC05XSspPyhifGR8aXxmfHMpL1xufTtcblxuaW50ZXJmYWNlIFNlZ21lbnRGb3JtYXQge1xuICBzaWduPzogYm9vbGVhbjtcbiAgcHJlY2lzaW9uPzogbnVtYmVyO1xuICBmdW4/OiAoYXJnOiBhbnkpID0+IHN0cmluZztcbiAgd2lkdGg/OiBudW1iZXI7XG4gIHBhZD86IHN0cmluZztcbiAgbGVmdD86IGJvb2xlYW47XG59XG5cbmludGVyZmFjZSBGdW5jdGlvbk1hcCB7XG4gIFtrZXk6IHN0cmluZ106ICgoYXJnOiBhbnkpID0+IHN0cmluZyl8dW5kZWZpbmVkO1xufVxuXG5jb25zdCBmdW46IEZ1bmN0aW9uTWFwID0ge1xuICBiKGFyZzogYW55KSB7XG4gICAgcmV0dXJuIGFyZyA/ICd0cnVlJyA6ICdmYWxzZSc7XG4gIH0sXG4gIGQoYXJnOiBhbnkpOiBzdHJpbmcge1xuICAgICAgY29uc3QgeCA9IHBhcnNlSW50KGFyZywgMTApO1xuICAgICAgY29uc3Qgc2lnbiA9ICh4IDwgMCkgPyAnLScgOiAoKDxTZWdtZW50Rm9ybWF0PnRoaXMpLnNpZ24gJiYgIWlzTmFOKHgpID8gJysnIDogJycpO1xuICAgICAgcmV0dXJuIGAke3NpZ259JHtNYXRoLmFicyh4KX1gO1xuICB9LFxuICBmIChhcmc6IGFueSk6IHN0cmluZyB7XG4gICAgICBjb25zdCB4ID0gcGFyc2VGbG9hdChhcmcpO1xuICAgICAgY29uc3Qgc2lnbiA9ICh4IDwgMCkgPyAnLScgOiAoKDxTZWdtZW50Rm9ybWF0PnRoaXMpLnNpZ24gJiYgIWlzTmFOKHgpID8gJysnIDogJycpO1xuICAgICAgcmV0dXJuICgoPFNlZ21lbnRGb3JtYXQ+dGhpcykucHJlY2lzaW9uKSA/IGAke3NpZ259JHtNYXRoLmFicyh4KS50b0ZpeGVkKCg8U2VnbWVudEZvcm1hdD50aGlzKS5wcmVjaXNpb24pfWAgOiBgJHtzaWdufSR7TWF0aC5hYnMoeCl9YDtcbiAgfSxcbiAgcyAoYXJnOiBhbnkpOiBzdHJpbmcgeyByZXR1cm4gYXJnOyB9XG59O1xuLy8gYWxpYXNlc1xuT2JqZWN0LmFzc2lnbihmdW4sIHtcbiAgaTogZnVuLmRcbn0pO1xuXG50eXBlIFNlZ21lbnQgPSBzdHJpbmd8U2VnbWVudEZvcm1hdDtcblxuaW50ZXJmYWNlIFNlZ21lbnRNYXAge1xuICBba2V5OiBzdHJpbmddOiBTZWdtZW50W11cbn1cblxuaW50ZXJmYWNlIFNwcmludGYge1xuICAoZm9ybWF0OiBzdHJpbmcsIC4uLmFyZ3M6IGFueVtdKTogc3RyaW5nO1xuICBjYWNoZTogU2VnbWVudE1hcDtcbiAgZm9ybWF0OiAoaXRlbXM6IFNlZ21lbnRbXSwgYXJnczogYW55W10pID0+IHN0cmluZztcbiAgcGFyc2U6IChmb3JtYXRTdHJpbmc6IHN0cmluZykgPT4gU2VnbWVudFtdO1xufVxuXG4vLyBjYWNoZWQgZnVuXG5jb25zdCBzcHJpbnRmOiBTcHJpbnRmID0gT2JqZWN0LmFzc2lnbihcbiAgZnVuY3Rpb24gKGZvcm1hdDogc3RyaW5nLCAuLi5hcmdzOiBhbnlbXSk6IHN0cmluZyB7XG4gICAgaWYgKHVuZGVmaW5lZCA9PT0gZm9ybWF0KSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignW3NwcmludGZdIGZvcm1hdCBtdXN0IGJlIHNwZWNpZmllZCcpO1xuICAgIH1cbiAgICBjb25zdCBjYWNoZSA9IHNwcmludGYuY2FjaGU7XG4gICAgaWYgKCEoY2FjaGVbZm9ybWF0XSAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoY2FjaGUsIGZvcm1hdCkpKSB7XG4gICAgICAgIGNhY2hlW2Zvcm1hdF0gPSBzcHJpbnRmLnBhcnNlKGZvcm1hdCk7XG4gICAgfVxuICAgIHJldHVybiBzcHJpbnRmLmZvcm1hdChjYWNoZVtmb3JtYXRdLCBhcmdzKTtcbiAgfSwge1xuICAgIGNhY2hlOiBPYmplY3QuY3JlYXRlKG51bGwpLFxuICAgIGZvcm1hdDogKGl0ZW1zOiBTZWdtZW50W10sIGFyZ3M6IGFueVtdKTogc3RyaW5nID0+IHtcbiAgICAgIHJldHVybiBpdGVtcy5tYXAoZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICAgICAgdmFyIHMsXG4gICAgICAgICAgICBpLFxuICAgICAgICAgICAgcGFkLFxuICAgICAgICAgICAgYXJnO1xuICAgICAgICBpZiAoJ3N0cmluZycgPT09IHR5cGVvZiBpdGVtKSB7XG4gICAgICAgICAgICBzID0gaXRlbTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGFyZyA9IGFyZ3Muc2hpZnQoKTtcbiAgICAgICAgICAgIHMgPSAoaXRlbS5mdW4gfHwgKCgpID0+ICcnKSkuY2FsbChpdGVtLCBhcmcpO1xuICAgICAgICAgICAgaWYgKGl0ZW0ud2lkdGgpIHtcbiAgICAgICAgICAgICAgICBpID0gaXRlbS53aWR0aCAtIHMubGVuZ3RoO1xuICAgICAgICAgICAgICAgIGlmIChpID4gMCkge1xuICAgICAgICAgICAgICAgICAgICBwYWQgPSAoaXRlbS5wYWQgfHwgJyAnKS5yZXBlYXQoaSk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChpdGVtLmxlZnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHMgPSBzICsgcGFkO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgcyA9IHBhZCArIHM7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHM7XG4gICAgICB9KS5qb2luKCcnKTtcbiAgICB9LFxuICAgIHBhcnNlOiBmdW5jdGlvbiAoZm10OiBzdHJpbmcpIHtcbiAgICAgIGNvbnN0IHJlc3VsdDogU2VnbWVudFtdID0gW107XG4gICAgICBsZXQgcmVzdCA9IGZtdDtcbiAgICAgIHdoaWxlICgwICE9PSByZXN0Lmxlbmd0aCkge1xuICAgICAgICAgIGxldCBtID0gci50ZXh0LmV4ZWMocmVzdCk7XG4gICAgICAgICAgaWYgKG0pIHtcbiAgICAgICAgICAgICAgcmVzdWx0LnB1c2gobVswXSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgbSA9IHIucGVyY2VudC5leGVjKHJlc3QpO1xuICAgICAgICAgICAgICBpZiAobSkge1xuICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goJyUnKTtcbiAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgIG0gPSByLmFyZy5leGVjKHJlc3QpO1xuICAgICAgICAgICAgICAgICAgaWYgKG0pIHtcbiAgICAgICAgICAgICAgICAgICAgICBjb25zdCBvOiBTZWdtZW50Rm9ybWF0ID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiAgICAgICAgICAgICAgICAgICAgICBjb25zdCBmbGFncyA9IG1bMV07XG4gICAgICAgICAgICAgICAgICAgICAgY29uc3Qgd2lkdGggPSBtWzJdO1xuICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHByZWMgPSBtWzNdO1xuICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHR5ID0gbVs0XTtcbiAgICAgICAgICAgICAgICAgICAgICBjb25zdCBmID0gZnVuW3R5XTtcbiAgICAgICAgICAgICAgICAgICAgICBpZiAoIWYpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdbc3ByaW50Zl0gaW52YWxpZCB0eXBlOiAnICsgdHkpO1xuICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICBvLmZ1biA9IGY7XG4gICAgICAgICAgICAgICAgICAgICAgLy8gZmxhZ3MgZmVsZG9sZ296w6FzYVxuICAgICAgICAgICAgICAgICAgICAgIGlmIChmbGFncykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoLTEgIT09IGZsYWdzLmluZGV4T2YoJy0nKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgby5sZWZ0ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoLTEgIT09IGZsYWdzLmluZGV4T2YoJysnKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgby5zaWduID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICBpZiAod2lkdGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgby53aWR0aCA9IHBhcnNlSW50KHdpZHRoLCAxMCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgtMSAhPT0gZmxhZ3MuaW5kZXhPZignMCcpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvLnBhZCA9ICcwJztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG8ucGFkID0gJyAnO1xuICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgIGlmIChwcmVjKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIG8ucHJlY2lzaW9uID0gcGFyc2VJbnQocHJlYy5zdWJzdHIoMSksIDEwKTtcbiAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2gobyk7XG4gICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignW3NwcmludGZdIGNvdWxkIG5vdCBwYXJzZTogJyArIHJlc3QpO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIHJlc3QgPSByZXN0LnN1YnN0cmluZyhtWzBdLmxlbmd0aCk7XG4gICAgICB9IC8vIHdoaWxlXG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cbiAgfVxuKTtcblxuZXhwb3J0IHsgc3ByaW50ZiB9Il19