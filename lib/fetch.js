const decorators = [];
const doFetch = (decorators, uri, init) => {
    let opts = init || {};
    for (const decorator of decorators) {
        const newOpts = decorator.decorate(uri, opts);
        if (newOpts) {
            opts = newOpts;
        }
    }
    return window.fetch(uri, opts);
};
export const decoratedFetch = Object.assign(Object.defineProperty((uri, init) => doFetch(decorators, uri, init), 'decorators', {
    get() { return decorators; }
}), {
    native: window.fetch.bind(window),
    include: (input) => {
        const ds = [];
        for (const key of input) {
            if ('string' === typeof key) {
                const d = decorators.find(x => x.name === key);
                if (!d) {
                    throw new Error('invalid or missing decorator: ' + key);
                }
                ds.push(d);
            }
            else {
                ds.push(key);
            }
        }
        return (uri, init) => doFetch(ds, uri, init);
    },
    exclude: (input) => {
        const ds = decorators.slice(0);
        for (const key of input) {
            if ('string' === typeof key) {
                const index = ds.findIndex(x => x.name === key);
                if (-1 !== index) {
                    ds.splice(index, 1);
                }
            }
            else {
                const index = ds.findIndex(x => x === key);
                if (-1 !== index) {
                    ds.splice(index, 1);
                }
            }
        }
        return (uri, init) => doFetch(ds, uri, init);
    }
});
const defaultErrors = {
    400: 'Bad request',
    500: 'Server error'
};
export class HttpError extends Error {
    constructor(response, message) {
        super(message ? message : defaultErrors[response.status] || `Unexpected error while fetching ${response.url}`);
        const that = this; // iOS workaround...
        Object.setPrototypeOf(that, HttpError.prototype);
        if ('function' === typeof Error.captureStackTrace) {
            Error.captureStackTrace(that, that.constructor);
        }
        this.response = response;
    }
}
export async function httpGet(uri) {
    const response = await decoratedFetch(uri, { method: 'GET' });
    if (response.ok) {
        return response;
    }
    const message = response.headers.get('X-Message');
    if (message) {
        throw new HttpError(response, message);
    }
    throw new HttpError(response);
}
export async function httpGetJson(uri) {
    const response = await httpGet(uri);
    return (await response.json());
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmV0Y2guanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvZmV0Y2gudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBbUJBLE1BQU0sVUFBVSxHQUFxQixFQUFFLENBQUM7QUFFeEMsTUFBTSxPQUFPLEdBQUcsQ0FBQyxVQUE0QixFQUFFLEdBQVcsRUFBRSxJQUEwQixFQUFFLEVBQUU7SUFDeEYsSUFBSSxJQUFJLEdBQUcsSUFBSSxJQUFJLEVBQUUsQ0FBQztJQUN0QixLQUFLLE1BQU0sU0FBUyxJQUFJLFVBQVUsRUFBRTtRQUNsQyxNQUFNLE9BQU8sR0FBRyxTQUFTLENBQUMsUUFBUSxDQUFDLEdBQUcsRUFBRSxJQUFJLENBQUMsQ0FBQztRQUM5QyxJQUFJLE9BQU8sRUFBRTtZQUNYLElBQUksR0FBRyxPQUFPLENBQUM7U0FDaEI7S0FDRjtJQUNELE9BQU8sTUFBTSxDQUFDLEtBQUssQ0FBQyxHQUFHLEVBQUUsSUFBSSxDQUFDLENBQUM7QUFDakMsQ0FBQyxDQUFDO0FBT0YsTUFBTSxDQUFDLE1BQU0sY0FBYyxHQUFtQixNQUFNLENBQUMsTUFBTSxDQUNoRCxNQUFNLENBQUMsY0FBYyxDQUFDLENBQUMsR0FBVyxFQUFFLElBQTBCLEVBQUUsRUFBRSxDQUFDLE9BQU8sQ0FBQyxVQUFVLEVBQUUsR0FBRyxFQUFFLElBQUksQ0FBQyxFQUFFLFlBQVksRUFBRTtJQUN4SCxHQUFHLEtBQUssT0FBTyxVQUFVLENBQUEsQ0FBQyxDQUFDO0NBQzVCLENBQUMsRUFBRTtJQUNGLE1BQU0sRUFBRSxNQUFNLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUM7SUFDakMsT0FBTyxFQUFFLENBQUMsS0FBZ0MsRUFBRSxFQUFFO1FBQzVDLE1BQU0sRUFBRSxHQUFxQixFQUFFLENBQUM7UUFDaEMsS0FBSyxNQUFNLEdBQUcsSUFBSSxLQUFLLEVBQUU7WUFDdkIsSUFBSSxRQUFRLEtBQUssT0FBTyxHQUFHLEVBQUU7Z0JBQzNCLE1BQU0sQ0FBQyxH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QUFHLENBQUMsV0FBVyxDQUFDLENBQUM7SUFDbEQsSUFBSSxPQUFPLEVBQUU7UUFDWCxNQUFNLElBQUksU0FBUyxDQUFDLFFBQVEsRUFBRSxPQUFPLENBQUMsQ0FBQztLQUN4QztJQUNELE1BQU0sSUFBSSxTQUFTLENBQUMsUUFBUSxDQUFDLENBQUM7QUFDaEMsQ0FBQztBQUVELE1BQU0sQ0FBQyxLQUFLLFVBQVUsV0FBVyxDQUFJLEdBQVc7SUFDOUMsTUFBTSxRQUFRLEdBQUcsTUFBTSxPQUFPLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDcEMsT0FBVSxDQUFDLE1BQU0sUUFBUSxDQUFDLElBQUksRUFBRSxDQUFDLENBQUM7QUFDcEMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIlxuZXhwb3J0IGludGVyZmFjZSBBbnlQcm9wIHtcbiAgW2tleTogc3RyaW5nXTogYW55XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgRmV0Y2hEZWNvcmF0b3Ige1xuICByZWFkb25seSBuYW1lOiBzdHJpbmc7XG4gIGRlY29yYXRlKHVyaTogc3RyaW5nLCBpbml0OiBSZXF1ZXN0SW5pdCZBbnlQcm9wKTogUmVxdWVzdEluaXQmQW55UHJvcDtcbn1cblxuXG5leHBvcnQgaW50ZXJmYWNlIERlY29yYXRlZEZldGNoIHtcbiAgKHVyaTogc3RyaW5nLCBpbml0OiBSZXF1ZXN0SW5pdCZBbnlQcm9wKTogUHJvbWlzZTxSZXNwb25zZT47XG4gIHJlYWRvbmx5IGRlY29yYXRvcnM6IEZldGNoRGVjb3JhdG9yW107XG4gIG5hdGl2ZSh1cmk6IHN0cmluZywgaW5pdDogUmVxdWVzdEluaXQpOiBQcm9taXNlPFJlc3BvbnNlPjtcbiAgaW5jbHVkZShkZWNvcmF0b3JzOiAoc3RyaW5nfEZldGNoRGVjb3JhdG9yKVtdKTogKHVyaTogc3RyaW5nLCBpbml0OiBSZXF1ZXN0SW5pdCZBbnlQcm9wKSA9PiBQcm9taXNlPFJlc3BvbnNlPjtcbiAgZXhjbHVkZShkZWNvcmF0b3JzOiAoc3RyaW5nfEZldGNoRGVjb3JhdG9yKVtdKTogKHVyaTogc3RyaW5nLCBpbml0OiBSZXF1ZXN0SW5pdCZBbnlQcm9wKSA9PiBQcm9taXNlPFJlc3BvbnNlPjtcbn1cblxuY29uc3QgZGVjb3JhdG9yczogRmV0Y2hEZWNvcmF0b3JbXSA9IFtdO1xuXG5jb25zdCBkb0ZldGNoID0gKGRlY29yYXRvcnM6IEZldGNoRGVjb3JhdG9yW10sIHVyaTogc3RyaW5nLCBpbml0PzogUmVxdWVzdEluaXQmQW55UHJvcCkgPT4ge1xuICBsZXQgb3B0cyA9IGluaXQgfHwge307XG4gIGZvciAoY29uc3QgZGVjb3JhdG9yIG9mIGRlY29yYXRvcnMpIHtcbiAgICBjb25zdCBuZXdPcHRzID0gZGVjb3JhdG9yLmRlY29yYXRlKHVyaSwgb3B0cyk7XG4gICAgaWYgKG5ld09wdHMpIHtcbiAgICAgIG9wdHMgPSBuZXdPcHRzO1xuICAgIH1cbiAgfVxuICByZXR1cm4gd2luZG93LmZldGNoKHVyaSwgb3B0cyk7XG59O1xuXG5pbnRlcmZhY2UgSW5pdGlhbCB7XG4gICh1cmk6IHN0cmluZywgaW5pdDogUmVxdWVzdEluaXQmQW55UHJvcCk6IFByb21pc2U8UmVzcG9uc2U+O1xuICByZWFkb25seSBkZWNvcmF0b3JzOiBGZXRjaERlY29yYXRvcltdXG59XG5cbmV4cG9ydCBjb25zdCBkZWNvcmF0ZWRGZXRjaDogRGVjb3JhdGVkRmV0Y2ggPSBPYmplY3QuYXNzaWduKFxuICA8SW5pdGlhbD5PYmplY3QuZGVmaW5lUHJvcGVydHkoKHVyaTogc3RyaW5nLCBpbml0PzogUmVxdWVzdEluaXQmQW55UHJvcCkgPT4gZG9GZXRjaChkZWNvcmF0b3JzLCB1cmksIGluaXQpLCAnZGVjb3JhdG9ycycsIHtcbiAgICBnZXQoKSB7IHJldHVybiBkZWNvcmF0b3JzIH1cbiAgfSksIHtcbiAgICBuYXRpdmU6IHdpbmRvdy5mZXRjaC5iaW5kKHdpbmRvdyksXG4gICAgaW5jbHVkZTogKGlucHV0OiAoc3RyaW5nfEZldGNoRGVjb3JhdG9yKVtdKSA9PiB7XG4gICAgICBjb25zdCBkczogRmV0Y2hEZWNvcmF0b3JbXSA9IFtdO1xuICAgICAgZm9yIChjb25zdCBrZXkgb2YgaW5wdXQpIHtcbiAgICAgICAgaWYgKCdzdHJpbmcnID09PSB0eXBlb2Yga2V5KSB7XG4gICAgICAgICAgY29uc3QgZCA9IGRlY29yYXRvcnMuZmluZCh4ID0+IHgubmFtZSA9PT0ga2V5KTtcbiAgICAgICAgICBpZiAoIWQpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignaW52YWxpZCBvciBtaXNzaW5nIGRlY29yYXRvcjogJyArIGtleSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGRzLnB1c2goZCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgZHMucHVzaChrZXkpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gKHVyaTogc3RyaW5nLCBpbml0PzogUmVxdWVzdEluaXQmQW55UHJvcCkgPT4gZG9GZXRjaChkcywgdXJpLCBpbml0KTtcbiAgICB9LFxuICAgIGV4Y2x1ZGU6IChpbnB1dDogKHN0cmluZ3xGZXRjaERlY29yYXRvcilbXSkgPT4ge1xuICAgICAgY29uc3QgZHM6IEZldGNoRGVjb3JhdG9yW10gPSBkZWNvcmF0b3JzLnNsaWNlKDApO1xuICAgICAgZm9yIChjb25zdCBrZXkgb2YgaW5wdXQpIHtcbiAgICAgICAgaWYgKCdzdHJpbmcnID09PSB0eXBlb2Yga2V5KSB7XG4gICAgICAgICAgY29uc3QgaW5kZXggPSBkcy5maW5kSW5kZXgoeCA9PiB4Lm5hbWUgPT09IGtleSk7XG4gICAgICAgICAgaWYgKC0xICE9PSBpbmRleCkge1xuICAgICAgICAgICAgZHMuc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY29uc3QgaW5kZXggPSBkcy5maW5kSW5kZXgoeCA9PiB4ID09PSBrZXkpO1xuICAgICAgICAgIGlmICgtMSAhPT0gaW5kZXgpIHtcbiAgICAgICAgICAgIGRzLnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gKHVyaTogc3RyaW5nLCBpbml0PzogUmVxdWVzdEluaXQmQW55UHJvcCkgPT4gZG9GZXRjaChkcywgdXJpLCBpbml0KTtcbiAgICB9XG4gIH1cbik7XG5cbmNvbnN0IGRlZmF1bHRFcnJvcnM6IHsgW2tleTogbnVtYmVyXTogc3RyaW5nfHVuZGVmaW5lZCB9ID0ge1xuICA0MDA6ICdCYWQgcmVxdWVzdCcsXG4gIDUwMDogJ1NlcnZlciBlcnJvcidcbn1cblxuZXhwb3J0IGNsYXNzIEh0dHBFcnJvciBleHRlbmRzIEVycm9yIHtcbiAgcmVzcG9uc2U6IFJlc3BvbnNlO1xuICBjb25zdHJ1Y3RvcihyZXNwb25zZTogUmVzcG9uc2UsIG1lc3NhZ2U/OiBzdHJpbmcpIHtcbiAgICBzdXBlcihtZXNzYWdlID8gbWVzc2FnZSA6IGRlZmF1bHRFcnJvcnNbcmVzcG9uc2Uuc3RhdHVzXSB8fCBgVW5leHBlY3RlZCBlcnJvciB3aGlsZSBmZXRjaGluZyAke3Jlc3BvbnNlLnVybH1gKTtcbiAgICBjb25zdCB0aGF0ID0gdGhpczsgLy8gaU9TIHdvcmthcm91bmQuLi5cbiAgICBPYmplY3Quc2V0UHJvdG90eXBlT2YodGhhdCwgSHR0cEVycm9yLnByb3RvdHlwZSk7XG4gICAgaWYgKCdmdW5jdGlvbicgPT09IHR5cGVvZiAoPGFueT5FcnJvcikuY2FwdHVyZVN0YWNrVHJhY2UpIHtcbiAgICAgICg8YW55PkVycm9yKS5jYXB0dXJlU3RhY2tUcmFjZSh0aGF0LCB0aGF0LmNvbnN0cnVjdG9yKTtcbiAgICB9XG4gICAgdGhpcy5yZXNwb25zZSA9IHJlc3BvbnNlO1xuICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBodHRwR2V0KHVyaTogc3RyaW5nKSB7XG4gIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZGVjb3JhdGVkRmV0Y2godXJpLCB7IG1ldGhvZDogJ0dFVCcgfSk7XG4gIGlmIChyZXNwb25zZS5vaykge1xuICAgIHJldHVybiByZXNwb25zZTtcbiAgfVxuICBjb25zdCBtZXNzYWdlID0gcmVzcG9uc2UuaGVhZGVycy5nZXQoJ1gtTWVzc2FnZScpO1xuICBpZiAobWVzc2FnZSkge1xuICAgIHRocm93IG5ldyBIdHRwRXJyb3IocmVzcG9uc2UsIG1lc3NhZ2UpO1xuICB9XG4gIHRocm93IG5ldyBIdHRwRXJyb3IocmVzcG9uc2UpO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gaHR0cEdldEpzb248VD4odXJpOiBzdHJpbmcpIHtcbiAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBodHRwR2V0KHVyaSk7XG4gIHJldHVybiA8VD4oYXdhaXQgcmVzcG9uc2UuanNvbigpKTtcbn0iXX0=