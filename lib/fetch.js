const decorators = [];
const doFetch = (decorators, uri, init) => {
    let opts = init || {};
    for (const decorator of decorators) {
        const newOpts = decorator.decorate(uri, opts);
        if (newOpts) {
            opts = newOpts;
        }
    }
    return window.fetch(uri, opts);
};
export const decoratedFetch = Object.assign(Object.defineProperty((uri, init) => doFetch(decorators, uri, init), 'decorators', {
    get() { return decorators; }
}), {
    native: window.fetch.bind(window),
    include: (input) => {
        const ds = [];
        for (const key of input) {
            if ('string' === typeof key) {
                const d = decorators.find(x => x.name === key);
                if (!d) {
                    throw new Error('invalid or missing decorator: ' + key);
                }
                ds.push(d);
            }
            else {
                ds.push(key);
            }
        }
        return (uri, init) => doFetch(ds, uri, init);
    },
    exclude: (input) => {
        const ds = decorators.slice(0);
        for (const key of input) {
            if ('string' === typeof key) {
                const index = ds.findIndex(x => x.name === key);
                if (-1 !== index) {
                    ds.splice(index, 1);
                }
            }
            else {
                const index = ds.findIndex(x => x === key);
                if (-1 !== index) {
                    ds.splice(index, 1);
                }
            }
        }
        return (uri, init) => doFetch(ds, uri, init);
    }
});
const defaultErrors = {
    400: 'Bad request',
    500: 'Server error'
};
export class HttpError extends Error {
    constructor(response, message) {
        super(message ? message : defaultErrors[response.status] || `Unexpected error while fetching ${response.url}`);
        const that = this; // iOS workaround...
        Object.setPrototypeOf(that, HttpError.prototype);
        if ('function' === typeof Error.captureStackTrace) {
            Error.captureStackTrace(that, that.constructor);
        }
        this.response = response;
    }
}
export async function httpGet(uri) {
    const response = await decoratedFetch(uri, { method: 'GET' });
    if (response.ok) {
        return response;
    }
    const message = response.headers.get('X-Message');
    if (message) {
        throw new HttpError(response, message);
    }
    throw new HttpError(response);
}
export async function httpGetJson(uri) {
    const response = await httpGet(uri);
    return (await response.json());
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmV0Y2guanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvZmV0Y2gudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBa0JBLE1BQU0sVUFBVSxHQUFxQixFQUFFLENBQUM7QUFFeEMsTUFBTSxPQUFPLEdBQUcsQ0FBQyxVQUE0QixFQUFFLEdBQVcsRUFBRSxJQUEwQixFQUFFLEVBQUU7SUFDeEYsSUFBSSxJQUFJLEdBQUcsSUFBSSxJQUFJLEVBQUUsQ0FBQztJQUN0QixLQUFLLE1BQU0sU0FBUyxJQUFJLFVBQVUsRUFBRTtRQUNsQyxNQUFNLE9BQU8sR0FBRyxTQUFTLENBQUMsUUFBUSxDQUFDLEdBQUcsRUFBRSxJQUFJLENBQUMsQ0FBQztRQUM5QyxJQUFJLE9BQU8sRUFBRTtZQUNYLElBQUksR0FBRyxPQUFPLENBQUM7U0FDaEI7S0FDRjtJQUNELE9BQU8sTUFBTSxDQUFDLEtBQUssQ0FBQyxHQUFHLEVBQUUsSUFBSSxDQUFDLENBQUM7QUFDakMsQ0FBQyxDQUFDO0FBT0YsTUFBTSxDQUFDLE1BQU0sY0FBYyxHQUFtQixNQUFNLENBQUMsTUFBTSxDQUNoRCxNQUFNLENBQUMsY0FBYyxDQUFDLENBQUMsR0FBVyxFQUFFLElBQTBCLEVBQUUsRUFBRSxDQUFDLE9BQU8sQ0FBQyxVQUFVLEVBQUUsR0FBRyxFQUFFLElBQUksQ0FBQyxFQUFFLFlBQVksRUFBRTtJQUN4SCxHQUFHLEtBQUssT0FBTyxVQUFVLENBQUEsQ0FBQyxDQUFDO0NBQzVCLENBQUMsRUFBRTtJQUNGLE1BQU0sRUFBRSxNQUFNLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUM7SUFDakMsT0FBTyxFQUFFLENBQUMsS0FBZ0MsRUFBRSxFQUFFO1FBQzVDLE1BQU0sRUFBRSxHQUFxQixFQUFFLENBQUM7UUFDaEMsS0FBSyxNQUFNLEdBQUcsSUFBSSxLQUFLLEVBQUU7WUFDdkIsSUFBSSxRQUFRLEtBQUssT0FBTyxHQUFHLEVBQUU7Z0JBQzNCLE1BQU0sQ0FBQyxH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QUFHLENBQUMsV0FBVyxDQUFDLENBQUM7SUFDbEQsSUFBSSxPQUFPLEVBQUU7UUFDWCxNQUFNLElBQUksU0FBUyxDQUFDLFFBQVEsRUFBRSxPQUFPLENBQUMsQ0FBQztLQUN4QztJQUNELE1BQU0sSUFBSSxTQUFTLENBQUMsUUFBUSxDQUFDLENBQUM7QUFDaEMsQ0FBQztBQUVELE1BQU0sQ0FBQyxLQUFLLFVBQVUsV0FBVyxDQUFJLEdBQVc7SUFDOUMsTUFBTSxRQUFRLEdBQUcsTUFBTSxPQUFPLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDcEMsT0FBVSxDQUFDLE1BQU0sUUFBUSxDQUFDLElBQUksRUFBRSxDQUFDLENBQUM7QUFDcEMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIlxuZXhwb3J0IGludGVyZmFjZSBGZXRjaERlY29yYXRvciB7XG4gIHJlYWRvbmx5IG5hbWU6IHN0cmluZztcbiAgZGVjb3JhdGU8VCBleHRlbmRzIFJlcXVlc3RJbml0Pih1cmk6IHN0cmluZywgaW5pdDogVCk6IFR8dm9pZDtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBBbnlQcm9wIHtcbiAgW2tleTogc3RyaW5nXTogYW55XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgRGVjb3JhdGVkRmV0Y2gge1xuICAodXJpOiBzdHJpbmcsIGluaXQ6IFJlcXVlc3RJbml0JkFueVByb3ApOiBQcm9taXNlPFJlc3BvbnNlPjtcbiAgcmVhZG9ubHkgZGVjb3JhdG9yczogRmV0Y2hEZWNvcmF0b3JbXTtcbiAgbmF0aXZlKHVyaTogc3RyaW5nLCBpbml0OiBSZXF1ZXN0SW5pdCk6IFByb21pc2U8UmVzcG9uc2U+O1xuICBpbmNsdWRlKGRlY29yYXRvcnM6IChzdHJpbmd8RmV0Y2hEZWNvcmF0b3IpW10pOiAodXJpOiBzdHJpbmcsIGluaXQ6IFJlcXVlc3RJbml0JkFueVByb3ApID0+IFByb21pc2U8UmVzcG9uc2U+O1xuICBleGNsdWRlKGRlY29yYXRvcnM6IChzdHJpbmd8RmV0Y2hEZWNvcmF0b3IpW10pOiAodXJpOiBzdHJpbmcsIGluaXQ6IFJlcXVlc3RJbml0JkFueVByb3ApID0+IFByb21pc2U8UmVzcG9uc2U+O1xufVxuXG5jb25zdCBkZWNvcmF0b3JzOiBGZXRjaERlY29yYXRvcltdID0gW107XG5cbmNvbnN0IGRvRmV0Y2ggPSAoZGVjb3JhdG9yczogRmV0Y2hEZWNvcmF0b3JbXSwgdXJpOiBzdHJpbmcsIGluaXQ/OiBSZXF1ZXN0SW5pdCZBbnlQcm9wKSA9PiB7XG4gIGxldCBvcHRzID0gaW5pdCB8fCB7fTtcbiAgZm9yIChjb25zdCBkZWNvcmF0b3Igb2YgZGVjb3JhdG9ycykge1xuICAgIGNvbnN0IG5ld09wdHMgPSBkZWNvcmF0b3IuZGVjb3JhdGUodXJpLCBvcHRzKTtcbiAgICBpZiAobmV3T3B0cykge1xuICAgICAgb3B0cyA9IG5ld09wdHM7XG4gICAgfVxuICB9XG4gIHJldHVybiB3aW5kb3cuZmV0Y2godXJpLCBvcHRzKTtcbn07XG5cbmludGVyZmFjZSBJbml0aWFsIHtcbiAgKHVyaTogc3RyaW5nLCBpbml0OiBSZXF1ZXN0SW5pdCZBbnlQcm9wKTogUHJvbWlzZTxSZXNwb25zZT47XG4gIHJlYWRvbmx5IGRlY29yYXRvcnM6IEZldGNoRGVjb3JhdG9yW11cbn1cblxuZXhwb3J0IGNvbnN0IGRlY29yYXRlZEZldGNoOiBEZWNvcmF0ZWRGZXRjaCA9IE9iamVjdC5hc3NpZ24oXG4gIDxJbml0aWFsPk9iamVjdC5kZWZpbmVQcm9wZXJ0eSgodXJpOiBzdHJpbmcsIGluaXQ/OiBSZXF1ZXN0SW5pdCZBbnlQcm9wKSA9PiBkb0ZldGNoKGRlY29yYXRvcnMsIHVyaSwgaW5pdCksICdkZWNvcmF0b3JzJywge1xuICAgIGdldCgpIHsgcmV0dXJuIGRlY29yYXRvcnMgfVxuICB9KSwge1xuICAgIG5hdGl2ZTogd2luZG93LmZldGNoLmJpbmQod2luZG93KSxcbiAgICBpbmNsdWRlOiAoaW5wdXQ6IChzdHJpbmd8RmV0Y2hEZWNvcmF0b3IpW10pID0+IHtcbiAgICAgIGNvbnN0IGRzOiBGZXRjaERlY29yYXRvcltdID0gW107XG4gICAgICBmb3IgKGNvbnN0IGtleSBvZiBpbnB1dCkge1xuICAgICAgICBpZiAoJ3N0cmluZycgPT09IHR5cGVvZiBrZXkpIHtcbiAgICAgICAgICBjb25zdCBkID0gZGVjb3JhdG9ycy5maW5kKHggPT4geC5uYW1lID09PSBrZXkpO1xuICAgICAgICAgIGlmICghZCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdpbnZhbGlkIG9yIG1pc3NpbmcgZGVjb3JhdG9yOiAnICsga2V5KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZHMucHVzaChkKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBkcy5wdXNoKGtleSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiAodXJpOiBzdHJpbmcsIGluaXQ/OiBSZXF1ZXN0SW5pdCZBbnlQcm9wKSA9PiBkb0ZldGNoKGRzLCB1cmksIGluaXQpO1xuICAgIH0sXG4gICAgZXhjbHVkZTogKGlucHV0OiAoc3RyaW5nfEZldGNoRGVjb3JhdG9yKVtdKSA9PiB7XG4gICAgICBjb25zdCBkczogRmV0Y2hEZWNvcmF0b3JbXSA9IGRlY29yYXRvcnMuc2xpY2UoMCk7XG4gICAgICBmb3IgKGNvbnN0IGtleSBvZiBpbnB1dCkge1xuICAgICAgICBpZiAoJ3N0cmluZycgPT09IHR5cGVvZiBrZXkpIHtcbiAgICAgICAgICBjb25zdCBpbmRleCA9IGRzLmZpbmRJbmRleCh4ID0+IHgubmFtZSA9PT0ga2V5KTtcbiAgICAgICAgICBpZiAoLTEgIT09IGluZGV4KSB7XG4gICAgICAgICAgICBkcy5zcGxpY2UoaW5kZXgsIDEpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjb25zdCBpbmRleCA9IGRzLmZpbmRJbmRleCh4ID0+IHggPT09IGtleSk7XG4gICAgICAgICAgaWYgKC0xICE9PSBpbmRleCkge1xuICAgICAgICAgICAgZHMuc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiAodXJpOiBzdHJpbmcsIGluaXQ/OiBSZXF1ZXN0SW5pdCZBbnlQcm9wKSA9PiBkb0ZldGNoKGRzLCB1cmksIGluaXQpO1xuICAgIH1cbiAgfVxuKTtcblxuY29uc3QgZGVmYXVsdEVycm9yczogeyBba2V5OiBudW1iZXJdOiBzdHJpbmd8dW5kZWZpbmVkIH0gPSB7XG4gIDQwMDogJ0JhZCByZXF1ZXN0JyxcbiAgNTAwOiAnU2VydmVyIGVycm9yJ1xufVxuXG5leHBvcnQgY2xhc3MgSHR0cEVycm9yIGV4dGVuZHMgRXJyb3Ige1xuICByZXNwb25zZTogUmVzcG9uc2U7XG4gIGNvbnN0cnVjdG9yKHJlc3BvbnNlOiBSZXNwb25zZSwgbWVzc2FnZT86IHN0cmluZykge1xuICAgIHN1cGVyKG1lc3NhZ2UgPyBtZXNzYWdlIDogZGVmYXVsdEVycm9yc1tyZXNwb25zZS5zdGF0dXNdIHx8IGBVbmV4cGVjdGVkIGVycm9yIHdoaWxlIGZldGNoaW5nICR7cmVzcG9uc2UudXJsfWApO1xuICAgIGNvbnN0IHRoYXQgPSB0aGlzOyAvLyBpT1Mgd29ya2Fyb3VuZC4uLlxuICAgIE9iamVjdC5zZXRQcm90b3R5cGVPZih0aGF0LCBIdHRwRXJyb3IucHJvdG90eXBlKTtcbiAgICBpZiAoJ2Z1bmN0aW9uJyA9PT0gdHlwZW9mICg8YW55PkVycm9yKS5jYXB0dXJlU3RhY2tUcmFjZSkge1xuICAgICAgKDxhbnk+RXJyb3IpLmNhcHR1cmVTdGFja1RyYWNlKHRoYXQsIHRoYXQuY29uc3RydWN0b3IpO1xuICAgIH1cbiAgICB0aGlzLnJlc3BvbnNlID0gcmVzcG9uc2U7XG4gIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGh0dHBHZXQodXJpOiBzdHJpbmcpIHtcbiAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBkZWNvcmF0ZWRGZXRjaCh1cmksIHsgbWV0aG9kOiAnR0VUJyB9KTtcbiAgaWYgKHJlc3BvbnNlLm9rKSB7XG4gICAgcmV0dXJuIHJlc3BvbnNlO1xuICB9XG4gIGNvbnN0IG1lc3NhZ2UgPSByZXNwb25zZS5oZWFkZXJzLmdldCgnWC1NZXNzYWdlJyk7XG4gIGlmIChtZXNzYWdlKSB7XG4gICAgdGhyb3cgbmV3IEh0dHBFcnJvcihyZXNwb25zZSwgbWVzc2FnZSk7XG4gIH1cbiAgdGhyb3cgbmV3IEh0dHBFcnJvcihyZXNwb25zZSk7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBodHRwR2V0SnNvbjxUPih1cmk6IHN0cmluZykge1xuICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGh0dHBHZXQodXJpKTtcbiAgcmV0dXJuIDxUPihhd2FpdCByZXNwb25zZS5qc29uKCkpO1xufSJdfQ==